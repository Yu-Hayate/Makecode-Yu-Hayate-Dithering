let colors=["#ffffff","#ff2121","#ff93c4","#ff8135","#fff609","#249ca3","#78dc52","#003fad","#87f2ff","#8e2ec4","#a4839f","#5c406c","#e5cdc4","#91463d","#000000"];function findNearestColor(c,d){let f=d[0],g=Math.abs(c[0]-f[0])+Math.abs(c[1]-f[1])+Math.abs(c[2]-f[2]);for(let e=1;e<d.length;e++){var[i,b,j]=d[e],j=Math.abs(c[0]-i)+Math.abs(c[1]-b)+Math.abs(c[2]-j);j<g&&(g=j,f=d[e])}return f}function getQuantErr(a,b){return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a}function applyErrBitShift(a,b,c,d){return c*=multiplier,a[0]+=b[0]*c>>d,a[1]+=b[1]*c>>d,a[2]+=b[2]*c>>d,a}function applyErrDiv(a,b,c,d){return c*=multiplier,d=1/d,(a[0]+=b[0]*c*d,a[1]+=b[1]*c*d,a[2]+=b[2]*c*d,a)}let enabledColorsList=Array(colors.length).fill(!0),filterList=[],filterEffectPowerList=[],time=0,multiplier=1;const listKey="$I",defaultColorList={color:colors,enabledColorsList:Array(colors.length).fill(!0)};renderColors();function updateMultiplier(){multiplier=parseFloat(document.getElementById("err_multi").value)||1}function processImage(){updateMultiplier();const a=document.getElementById("fileInput"),b=document.getElementById("scaleFactor"),c=document.getElementById("outputImage"),d=document.getElementById("colorArr"),e=document.getElementById("width").value,f=document.getElementById("height").value,g=document.getElementById("maxPixels").value,h=document.getElementById("ditheringOptions").value,i=new FileReader;i.onload=function(a){const d=new Image;d.onload=function(){const a=document.createElement("canvas"),i=a.getContext("2d");setCanvasSize(d,a,e,f,g,b.value),i.drawImage(d,0,0,a.width,a.height),applyFilter(i,a.width,a.height),applyDithering(i,a.width,a.height,h),c.src=a.toDataURL()},d.src=a.target.result},i.readAsDataURL(a.files[0]);const j=document.getElementById("downloadButton");j.addEventListener("click",downloadImage)}window.onload=function(){var a=document.getElementById("colorLists");a.innerHTML="";var b=document.createElement("option");b.text="Default",b.value="$IDefault",a.add(b);for(var c,d=0;d<localStorage.length;d++)if(c=localStorage.key(d),c.startsWith(listKey)){var e=c.substring(listKey.length),f=document.createElement("option");f.text=e,f.value=e,a.add(f)}renderColors()},document.getElementById("Filters").addEventListener("change",function(){var a=this.value,b=document.getElementById("customFilter"),c=document.getElementById("NoiseFilter"),d=document.getElementById("blurFilter"),e=document.getElementById("RadiusFilter"),f=document.getElementById("BrightenFilter");b.style.display="none",c.style.display="none",d.style.display="none",e.style.display="none",f.style.display="none","custom"===a?b.style.display="block":"noise"===a?c.style.display="block":"blur"===a?d.style.display="block":"median"===a?e.style.display="block":"Brighten"===a&&(f.style.display="block"),fliterOption=a}),document.getElementById("sizeSettings").addEventListener("change",function(){var a=this.value;document.getElementById("scaleOptions").style.display="none",document.getElementById("pixelGoalOptions").style.display="none",document.getElementById("widthHeightOptions").style.display="none",document.getElementById(a+"Options").style.display="block"}),document.getElementById("red").addEventListener("input",function(){changeColorPickerColor()}),document.getElementById("green").addEventListener("input",function(){changeColorPickerColor()}),document.getElementById("blue").addEventListener("input",function(){changeColorPickerColor()}),document.addEventListener("DOMContentLoaded",function(){var a=document.getElementById("ditheringOptions"),b=document.getElementById("hoverBox"),c=document.getElementById("hoverDescription");a.addEventListener("mouseover",function(a){if("OPTION"===a.target.tagName){var d=a.target.getAttribute("data-description"),e=a.target.getBoundingClientRect();c.textContent=d,b.style.display="block",b.style.left=e.left+"px",b.style.top=e.top+window.scrollY+20+"px"}}),a.addEventListener("mouseout",function(){b.style.display="none"})}),document.getElementById("fileInput").addEventListener("change",function(a){const b=a.target.files[0];if(!b)return;const c=new Image;c.onload=function(){const a=document.getElementById("width"),b=document.getElementById("height"),d=document.getElementById("maxPixels"),e=document.getElementById("scaleFactor"),f=window.innerWidth,g=Math.round(1e3*((f<<2)/14/c.width))/1e3,h=Math.floor(c.width*g),i=Math.floor(c.height*g);a.value=Math.max(h,1),b.value=Math.max(i,1),e.value=.1>=Math.abs(g-1)?1:g,processImage()};const d=new FileReader;d.onload=function(a){c.src=a.target.result},d.readAsDataURL(b)});function saveColorList(){var a=prompt("Enter a name for the color list:");if(a){var b={color:colors,enabledColorsList:enabledColorsList};localStorage.setItem(listKey+a,JSON.stringify(b));var c=document.getElementById("colorLists"),d=document.createElement("option");d.text=a,d.value=a,c.add(d),renderColors()}}function loadColorList(){var a=document.getElementById("colorLists").value;if(a!="$IDefault"){var b=localStorage.getItem(listKey+a);b&&(b=JSON.parse(b),colors=b.color,enabledColorsList=b.enabledColorsList)}else colors=defaultColorList.color,enabledColorsList=defaultColorList.enabledColorsList;renderColors()}function removeColorList(){var a=document.getElementById("colorLists").value;if(a!="$IDefault"){localStorage.removeItem(listKey+a);for(var b=document.getElementById("colorLists"),c=b.options,d=0;d<c.length;d++)if(c[d].value===a){b.remove(d);break}0===b.options.length&&(colors=defaultColorList.color,enabledColorsList=defaultColorList.enabledColorsList,renderColors())}}function setCanvasSize(a,b,c,d,e,f){const g=document.getElementById("sizeSettings").value;if("widthHeight"===g)-1==c&&-1==d?(b.width=a.width,b.height=a.height):(b.width=-1==c?a.width*(d/a.height):c,b.height=-1==d?a.height*(c/a.width):d);else if("pixelGoal"===g){const c=resizePixelGoal(a.width,a.height,e);b.width=c[0],b.height=c[1]}else b.width=a.width*f,b.height=a.height*f}function applyDithering(a,b,c,d){"none"==d?noneDithering(a,b,c):"floyd"==d?floydSteinbergDithering(a,b,c):"nearest"==d?ClosesColorDithering(a,b,c):"bayerMatrix4"==d?bayerDithering4x4(a,b,c):"bayerMatrix8"==d?bayerDithering8x8(a,b,c):"falseFloyd"==d?FalseFloydSteinbergDithering(a,b,c):"stucki"==d?stuckiDithering(a,b,c):"Burkes"==d?BurkesDithering(a,b,c):"bayerMatrix2"==d?bayerDithering2x2(a,b,c):"bayerMatrix16"==d&&bayerDithering16x16(a,b,c)}function applyFilter(a,c,d){if(0<filterList.length){for(let e=0;e<filterList.length;e++)if("GrayScale"==filterList[e])grayScale(a,c,d);else if("custom"==filterList[e]){const f=filterEffectPowerList[e][0],h=filterEffectPowerList[e][1],g=filterEffectPowerList[e][2];customFilter(a,c,d,f,h,g)}else if("noise"==filterList[e]){const b=filterEffectPowerList[e][0];noiseFilter(a,c,d,b)}else if("blur"==filterList[e]){const b=Math.min(Math.abs(filterEffectPowerList[e][0]),50);blurImage(a,c,d,b)}else if("invert"==filterList[e])InvertFilter(a,c,d);else if("unBlur"==filterList[e])unblurImage(a,c,d);else if("median"==filterList[e]){Math.min(Math.abs(filterEffectPowerList[e][0]),15);medianFilter(a,c,d,1)}else if("Brighten"==filterList[e]){Math.max(Math.abs(filterEffectPowerList[e][0]),.1);brightenFilter(a,c,d)}}else if(filterType=document.getElementById("Filters").value,"GrayScale"==filterType)grayScale(a,c,d);else if("custom"==filterType){const e=document.getElementById("red").value,f=document.getElementById("green").value,g=document.getElementById("blue").value;customFilter(a,c,d,e,f,g)}else if("noise"==filterType){const b=document.getElementById("noiseLevel").value;noiseFilter(a,c,d,b)}else if("blur"==filterType){const b=Math.min(Math.abs(document.getElementById("blurPower").value),50);blurImage(a,c,d,b)}else if("invert"==filterType)InvertFilter(a,c,d);else if("unBlur"==filterType)unblurImage(a,c,d);else if("median"==filterType){const b=Math.min(Math.abs(document.getElementById("radius").value),15);medianFilter(a,c,d,b)}else if("Brighten"==filterType){const b=Math.max(Math.abs(document.getElementById("Slider")),.1);brightenFilter(a,c,d,b)}}function brightenFilter(a,b,c,d){const e=a.getImageData(0,0,b,c),f=e.data;for(let e=0;e<f.length;e+=4){let a=f[e],c=f[e+1],g=f[e+2];a=Math.min(255,a*d),c=Math.min(255,c*d),g=Math.min(255,g*d),f[e]=a,f[e+1]=c,f[e+2]=g}a.putImageData(e,0,0)}function medianFilter(a,b,c,d){const e=a.getImageData(0,0,b,c),f=e.data,g=new Uint8ClampedArray(f.length);for(let e=0;e<c;e++)for(let a=0;a<b;a++){const h=4*(e*b+a),i=[],j=[],k=[];for(let g=-d;g<=d;g++)for(let h=-d;h<=d;h++){const d=a+h,l=e+g;if(0<=d&&d<b&&0<=l&&l<c){const a=4*(l*b+d);i.push(f[a]),j.push(f[a+1]),k.push(f[a+2])}}i.sort((c,a)=>c-a),j.sort((c,a)=>c-a),k.sort((c,a)=>c-a);const l=i[Math.floor(i.length/2)],m=j[Math.floor(j.length/2)],n=k[Math.floor(k.length/2)];g[h]=l,g[h+1]=m,g[h+2]=n,g[h+3]=f[h+3]}for(let e=0;e<f.length;e++)f[e]=g[e];a.putImageData(e,0,0)}const slider=document.getElementById("Slider"),valueDisplay=document.getElementById("sliderValue");slider.addEventListener("input",function(){const a=(100*slider.value).toFixed(0);valueDisplay.textContent=""+a+"%"});function downloadImage(){let a=document.getElementById("varName").value;const b=document.createElement("a");b.href=outputImage.src,b.download=a+".png",document.body.appendChild(b),b.click(),document.body.removeChild(b)}function convertImgStringToCanvas(a){a=a.replace("`","").replace("img","");const b=a.trim().split(/\s{2,}/).map(a=>a.trim()),c=b[0].split(" ").length,d=b.length,e=document.createElement("canvas"),f=e.getContext("2d"),g=document.getElementById("scaleFactor"),h=parseFloat(g.value),i=document.getElementById("width").value,j=document.getElementById("height").value,k=document.getElementById("maxPixels").value;if("widthHeight"===document.getElementById("sizeSettings").value)e.width=i,e.height=j;else if("pixelGoal"===document.getElementById("sizeSettings").value){let a=resizePixelGoal(c,d,k);e.width=a[0],e.height=a[1]}else e.width=c*h,e.height=d*h;const l=e.width/c,m=e.height/d;for(let e=0;e<d;e++){const a=b[e].split(" ");for(let b=0;b<c;b++){const c=a[b];if("."!==c){const a=parseInt(c,16)-1,d=colors[a];f.fillStyle=d,f.fillRect(b*l,e*m,l,m)}else f.fillStyle="#FFFFFF",f.fillRect(b*l,e*m,l,m)}}return e}function convertAndDownload(){var a=document.getElementById("makeCodeInput").value,b=convertImgStringToCanvas(a,colors),c=b,d=c.getContext("2d"),e=c.toDataURL("image/png"),f=document.createElement("a");f.href=e,f.download=document.getElementById("varName").value+".png",document.body.appendChild(f),f.click(),document.body.removeChild(f)}function changeColorPickerColor(){const a=document.getElementById("colorPicker"),b=parseInt(document.getElementById("red").value),c=parseInt(document.getElementById("green").value),d=parseInt(document.getElementById("blue").value),e=("0"+b.toString(16)).slice(-2),f=("0"+c.toString(16)).slice(-2),g=("0"+d.toString(16)).slice(-2);a.value="#"+e+f+g}function updateColors(){const a=document.getElementById("colorPicker"),b=document.getElementById("red"),c=document.getElementById("green"),d=document.getElementById("blue"),e=a.value,f=parseInt(e.substring(1,3),16),g=parseInt(e.substring(3,5),16),h=parseInt(e.substring(5,7),16);b.value=f,c.value=g,d.value=h}function removedisabledColors(a,b){const c=[];for(let d=0;d<a.length;d++)b[d]&&c.push(a[d]);return c}function setRGBValues(a,b,c){document.getElementById("red").value=a,document.getElementById("green").value=b,document.getElementById("blue").value=c}function resizePixelGoal(a,b,c){if(-1==c)return[a,b];var d=a/b,e=Math.sqrt(c*d),f=e/d;return e=Math.round(e),f=Math.round(f),[e,f]}function copyToClipboard(){let a=document.getElementById("varName").value;navigator.clipboard.writeText("let "+a+imageString),alert("Copied successfully! ")}function noneDithering(a,c,b){palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);var d=a.getImageData(0,0,c,b),e=d.data,f=[];for(let d=0;d<b;d++){var h=[];for(let a=0;a<c;a++){const f=4*(d*c+a),i=e[f],j=e[f+1],g=e[f+2];h.push(palArr.indexOf(findNearestColor([i,j,g],palArr))+1)}f.push(h)}imageString=" = img`\n";for(let d,e=0;e<f.length;e++){d=f[e];for(let a,b=0;b<d.length;b++)a=d[b],imageString+=a.toString(16)+" ";imageString+="\n"}imageString+="`"}function bayerDithering2x2(a,c,d){const e=[[0,2],[3,1]],f=e[0].length,h=e.length,i=Math.max(...e.flat()),j=removedisabledColors(hexToRgb(colors),enabledColorsList),k=a.getImageData(0,0,c,d),l=k.data,m=e.map(a=>a.map(a=>a/i));for(let e=0;e<d;e++)for(let a=0;a<c;a++){const d=4*(e*c+a),i=l[d],k=l[d+1],g=l[d+2],b=m[e%h][a%f]-.5,n=255*Math.min(Math.max(i/255+b,0),1),o=255*Math.min(Math.max(k/255+b,0),1),p=255*Math.min(Math.max(g/255+b,0),1),q=findNearestColor([n,o,p],j);l[d]=q[0],l[d+1]=q[1],l[d+2]=q[2]}a.putImageData(k,0,0)}function bayerDithering4x4(a,c,d){const e=[[0,8,2,10],[12,4,14,6],[3,11,1,9],[15,7,13,5]],f=e[0].length,h=e.length,i=Math.max(...e.flat()),j=removedisabledColors(hexToRgb(colors),enabledColorsList),k=a.getImageData(0,0,c,d),l=k.data,m=e.map(a=>a.map(a=>a/i));for(let e=0;e<d;e++)for(let a=0;a<c;a++){const d=4*(e*c+a),i=l[d],k=l[d+1],g=l[d+2],b=m[e%h][a%f]-.5,n=255*Math.min(Math.max(i/255+b,0),1),o=255*Math.min(Math.max(k/255+b,0),1),p=255*Math.min(Math.max(g/255+b,0),1),q=findNearestColor([n,o,p],j);l[d]=q[0],l[d+1]=q[1],l[d+2]=q[2]}a.putImageData(k,0,0)}function bayerDithering8x8(a,c,d){const e=[[0,48,12,60,3,51,15,63],[32,16,44,28,35,19,47,31],[8,56,4,52,11,59,7,55],[40,24,36,20,43,27,39,23],[2,50,14,62,1,49,13,61],[34,18,46,30,33,17,45,29],[10,58,6,54,9,57,5,53],[42,26,38,22,41,25,37,21]],f=e[0].length,h=e.length,i=Math.max(...e.flat()),j=removedisabledColors(hexToRgb(colors),enabledColorsList),k=a.getImageData(0,0,c,d),l=k.data,m=e.map(a=>a.map(a=>a/i));for(let e=0;e<d;e++)for(let a=0;a<c;a++){const d=4*(e*c+a),i=l[d],k=l[d+1],g=l[d+2],b=m[e%h][a%f]-.5,n=255*Math.min(Math.max(i/255+b,0),1),o=255*Math.min(Math.max(k/255+b,0),1),p=255*Math.min(Math.max(g/255+b,0),1),q=findNearestColor([n,o,p],j);l[d]=q[0],l[d+1]=q[1],l[d+2]=q[2]}a.putImageData(k,0,0)}function bayerDithering16x16(a,c,d){const e=[[0,192,48,240,12,204,60,252,3,195,51,243,15,207,63,255],[128,64,176,112,140,76,188,124,131,67,179,115,143,79,191,127],[32,224,16,208,44,236,28,220,35,227,19,211,47,239,31,223],[160,96,144,80,172,108,156,92,163,99,147,83,175,111,159,95],[8,200,56,248,4,196,52,244,11,203,59,251,7,199,55,247],[136,72,184,120,132,68,180,116,139,75,187,123,142,78,190,126],[40,232,24,216,36,228,20,212,43,235,27,219,39,231,23,215],[168,104,152,88,164,100,148,84,171,107,155,91,167,103,151,87],[2,194,50,242,14,206,62,254,1,193,49,241,13,205,61,253],[130,66,178,114,129,65,177,113,134,70,182,118,133,69,181,117],[34,226,18,210,46,238,30,222,33,225,17,209,45,237,29,221],[162,98,146,82,174,110,158,94,161,97,145,81,173,109,157,93],[10,202,58,250,6,198,54,246,9,201,57,249,5,197,53,245],[138,74,186,122,137,73,185,121,140,76,188,124,141,77,189,125],[42,234,26,218,38,230,22,214,41,233,25,217,37,229,21,213],[170,106,154,90,166,102,150,86,169,105,153,89,165,101,149,85]],f=e[0].length,h=e.length,i=Math.max(...e.flat()),j=removedisabledColors(hexToRgb(colors),enabledColorsList),k=a.getImageData(0,0,c,d),l=k.data,m=e.map(a=>a.map(a=>a/i));for(let e=0;e<d;e++)for(let a=0;a<c;a++){const d=4*(e*c+a),i=l[d],k=l[d+1],g=l[d+2],b=m[e%h][a%f]-.5,n=255*Math.min(Math.max(i/255+b,0),1),o=255*Math.min(Math.max(k/255+b,0),1),p=255*Math.min(Math.max(g/255+b,0),1),q=findNearestColor([n,o,p],j);l[d]=q[0],l[d+1]=q[1],l[d+2]=q[2]}a.putImageData(k,0,0)}function ClosesColorDithering(a,b,c){var d=a.getImageData(0,0,b,c),e=d.data,f=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var g,h=0;h<c;h++){g=[];for(var i,j=0;j<b;j++)i=4*(h*b+j),oldpixel=[e[i],e[i+1],e[i+2]],newpixel=findNearestColor(oldpixel,palArr),g.push(palArr.indexOf(newpixel)+1),e[i]=newpixel[0],e[i+1]=newpixel[1],e[i+2]=newpixel[2],e[i+3]=255;f.push(g)}imageString=" = img`\n";for(let d,e=0;e<f.length;e++){d=f[e];for(let a,b=0;b<d.length;b++)a=d[b],imageString+=a.toString(16)+" ";imageString+="\n"}imageString+="`",a.putImageData(d,0,0)}function floydSteinbergDithering(a,b,c){var d=a.getImageData(0,0,b,c),e=d.data,f=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var g,h=0;h<c;h++){g=[];for(var i,j=0;j<b;j++)i=4*(h*b+j),oldpixel=[e[i],e[i+1],e[i+2]],newpixel=findNearestColor(oldpixel,palArr),g.push(palArr.indexOf(newpixel)+1),e[i]=newpixel[0],e[i+1]=newpixel[1],e[i+2]=newpixel[2],e[i+3]=255,quantErr=getQuantErr(oldpixel,newpixel),i=4*(h*b+(j+1)),i<e.length&&(err=applyErrBitShift([e[i],e[i+1],e[i+2]],quantErr,7,4),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+(j-1)),i<e.length&&(err=applyErrBitShift([e[i],e[i+1],e[i+2]],quantErr,3,4),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+j),i<e.length&&(err=applyErrBitShift([e[i],e[i+1],e[i+2]],quantErr,5,4),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+(j+1)),i<e.length&&(err=applyErrBitShift([e[i],e[i+1],e[i+2]],quantErr,1,4),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]);f.push(g)}imageString=" = img`\n";for(let d,e=0;e<f.length;e++){d=f[e];for(let a,b=0;b<d.length;b++)a=d[b],imageString+=a.toString(16)+" ";imageString+="\n"}imageString+="`",a.putImageData(d,0,0)}function FalseFloydSteinbergDithering(a,b,c){var d=a.getImageData(0,0,b,c),e=d.data,f=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var g,h=0;h<c;h++){g=[];for(var i,j=0;j<b;j++)i=4*(h*b+j),oldpixel=[e[i],e[i+1],e[i+2]],newpixel=findNearestColor(oldpixel,palArr),g.push(palArr.indexOf(newpixel)+1),e[i]=newpixel[0],e[i+1]=newpixel[1],e[i+2]=newpixel[2],e[i+3]=255,quantErr=getQuantErr(oldpixel,newpixel),i=4*(h*b+(j+1)),i<e.length&&(err=applyErrBitShift([e[i],e[i+1],e[i+2]],quantErr,3,3),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+(j+1)),i<e.length&&(err=applyErrBitShift([e[i],e[i+1],e[i+2]],quantErr,2,3),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+j),i<e.length&&(err=applyErrBitShift([e[i],e[i+1],e[i+2]],quantErr,3,3),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]);f.push(g)}imageString=" = img`\n";for(let d,e=0;e<f.length;e++){d=f[e];for(let a,b=0;b<d.length;b++)a=d[b],imageString+=a.toString(16)+" ";imageString+="\n"}imageString+="`",a.putImageData(d,0,0)}function stuckiDithering(a,b,c){var d=a.getImageData(0,0,b,c),e=d.data,f=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var g,h=0;h<c;h++){g=[];for(var i,j=0;j<b;j++)i=4*(h*b+j),oldpixel=[e[i],e[i+1],e[i+2]],newpixel=findNearestColor(oldpixel,palArr),g.push(palArr.indexOf(newpixel)+1),e[i]=newpixel[0],e[i+1]=newpixel[1],e[i+2]=newpixel[2],e[i+3]=255,quantErr=getQuantErr(oldpixel,newpixel),i=4*(h*b+(j+1)),i<e.length&&(err=applyErrDiv([e[i],e[i+1],e[i+2]],quantErr,8,42),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*(h*b+(j+2)),i<e.length&&(err=applyErrDiv([e[i],e[i+1],e[i+2]],quantErr,4,42),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+(j-2)),i<e.length&&(err=applyErrDiv([e[i],e[i+1],e[i+2]],quantErr,2,42),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+(j-1)),i<e.length&&(err=applyErrDiv([e[i],e[i+1],e[i+2]],quantErr,4,42),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+j),i<e.length&&(err=applyErrDiv([e[i],e[i+1],e[i+2]],quantErr,8,42),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+(j+1)),i<e.length&&(err=applyErrDiv([e[i],e[i+1],e[i+2]],quantErr,4,42),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+(j+2)),i<e.length&&(err=applyErrDiv([e[i],e[i+1],e[i+2]],quantErr,2,42),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+2)*b+(j-2)),i<e.length&&(err=applyErrDiv([e[i],e[i+1],e[i+2]],quantErr,1,42),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+2)*b+(j-1)),i<e.length&&(err=applyErrDiv([e[i],e[i+1],e[i+2]],quantErr,2,42),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+2)*b+j),i<e.length&&(err=applyErrDiv([e[i],e[i+1],e[i+2]],quantErr,4,42),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+2)*b+(j+1)),i<e.length&&(err=applyErrDiv([e[i],e[i+1],e[i+2]],quantErr,2,42),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+2)*b+(j+2)),i<e.length&&(err=applyErrDiv([e[i],e[i+1],e[i+2]],quantErr,1,42),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]);f.push(g)}imageString=" = img`\n";for(let d,e=0;e<f.length;e++){d=f[e];for(let a,b=0;b<d.length;b++)a=d[b],imageString+=a.toString(16)+" ";imageString+="\n"}imageString+="`",a.putImageData(d,0,0)}function BurkesDithering(a,b,c){var d=a.getImageData(0,0,b,c),e=d.data,f=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var g,h=0;h<c;h++){g=[];for(var i,j=0;j<b;j++)i=4*(h*b+j),oldpixel=[e[i],e[i+1],e[i+2]],newpixel=findNearestColor(oldpixel,palArr),g.push(palArr.indexOf(newpixel)+1),e[i]=newpixel[0],e[i+1]=newpixel[1],e[i+2]=newpixel[2],e[i+3]=255,quantErr=getQuantErr(oldpixel,newpixel),i=4*(h*b+(j+1)),i<e.length&&(err=applyErrBitShift([e[i],e[i+1],e[i+2]],quantErr,8,5),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*(h*b+(j+2)),i<e.length&&(err=applyErrBitShift([e[i],e[i+1],e[i+2]],quantErr,4,5),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+(j-2)),i<e.length&&(err=applyErrBitShift([e[i],e[i+1],e[i+2]],quantErr,2,5),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+(j-1)),i<e.length&&(err=applyErrBitShift([e[i],e[i+1],e[i+2]],quantErr,4,5),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+j),i<e.length&&(err=applyErrBitShift([e[i],e[i+1],e[i+2]],quantErr,8,5),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+(j+1)),i<e.length&&(err=applyErrBitShift([e[i],e[i+1],e[i+2]],quantErr,4,5),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]),i=4*((h+1)*b+(j+2)),i<e.length&&(err=applyErrBitShift([e[i],e[i+1],e[i+2]],quantErr,2,5),e[i]=err[0],e[i+1]=err[1],e[i+2]=err[2]);f.push(g)}imageString=" = img`\n";for(let d,e=0;e<f.length;e++){d=f[e];for(let a,b=0;b<d.length;b++)a=d[b],imageString+=a.toString(16)+" ";imageString+="\n"}imageString+="`",a.putImageData(d,0,0)}function InvertFilter(a,b,c){const d=a.getImageData(0,0,b,c),e=d.data;for(let d=0;d<e.length;d+=4){const a=e[d],c=e[d+1],f=e[d+2];e[d]=255-a,e[d+1]=255-c,e[d+2]=255-f}a.putImageData(d,0,0)}function noiseFilter(a,b,c,d){const e=a.getImageData(0,0,b,c),f=e.data;for(let e=0;e<f.length;e+=4){const a=f[e],c=f[e+1],g=f[e+2],b=[a+Math.random()*d,c+Math.random()*d,g+Math.random()*d];f[e]=Math.floor((a+b[0])/2),f[e+1]=Math.floor((c+b[1])/2),f[e+2]=Math.floor((g+b[2])/2)}a.putImageData(e,0,0)}function customFilter(a,b,c,d,e,f){const g=a.getImageData(0,0,b,c),h=g.data;for(let j=0;j<h.length;j+=4){const a=h[j],c=h[j+1],g=h[j+2];h[j]=d/255*a,h[j+1]=e/255*c,h[j+2]=f/255*g}a.putImageData(g,0,0)}function grayScale(a,b,c){const d=a.getImageData(0,0,b,c),e=d.data;for(let d=0;d<e.length;d+=4){const a=e[d],c=e[d+1],f=e[d+2],b=(a+c+f)/3;e[d]=b,e[d+1]=b,e[d+2]=b}a.putImageData(d,0,0)}function blurImage(a,c,b,d){const e=a.getImageData(0,0,c,b),f=e.data,g=Math.floor(d/2),h=1/Math.pow(2*g+1,2),j=new Uint8ClampedArray(f.length);for(let e=0;e<b;e++)for(let d=0;d<c;d++){let i=0,k=0,l=0,m=0;for(let a=-g;a<=g;a++)for(let b=-g;b<=g;b++){const g=e+a,j=d+b;if(0<=g&&g<b&&0<=j&&j<c){const a=4*(g*c+j),b=h;i+=f[a]*b,k+=f[a+1]*b,l+=f[a+2]*b,m+=f[a+3]*b}}const a=4*(e*c+d);j[a]=i,j[a+1]=k,j[a+2]=l,j[a+3]=m}for(let e=0;e<j.length;e++)f[e]=j[e];a.putImageData(e,0,0)}function unblurImage(a,c,b){const d=[[0,-1,0],[-1,5,-1],[0,-1,0]],e=a.getImageData(0,0,c,b),f=e.data,g=new Uint8ClampedArray(f.length);for(let e=0;e<b;e++)for(let a=0;a<c;a++){const h=4*(e*c+a),i=[0,0,0];for(let g=-1;1>=g;g++)for(let h=-1;1>=h;h++){const j=d[g+1][h+1],k=a+h,l=e+g;if(0<=k&&k<c&&0<=l&&l<b){const a=4*(l*c+k),d=f[a],e=f[a+1],g=f[a+2];i[0]+=d*j,i[1]+=e*j,i[2]+=g*j}}g[h]=i[0],g[h+1]=i[1],g[h+2]=i[2],g[h+3]=f[h+3]}for(let d=0;d<f.length;d++)f[d]=g[d];a.putImageData(e,0,0)}function addColor(){const a=document.getElementById("colorInput"),b=a.value.trim();b&&(colors.push(b),enabledColorsList.push(!0),renderColors())}function changeColor(a){const b=document.getElementById("colorInput"),c=b.value.trim();colors[a]=c,renderColors()}function removeColor(a){colors.splice(a,1),enabledColorsList.splice(a,1),renderColors()}function moveColorUp(a){if(0<a){const b=[colors[a],colors[a-1]];colors[a]=b[1],colors[a-1]=b[0];const c=[enabledColorsList[a],enabledColorsList[a-1]];enabledColorsList[a]=c[1],enabledColorsList[a-1]=c[0],renderColors()}}function moveColorDown(a){if(a<colors.length-1){const b=[colors[a],colors[a+1]];colors[a]=b[1],colors[a+1]=b[0];const c=[enabledColorsList[a],enabledColorsList[a+1]];enabledColorsList[a]=c[1],enabledColorsList[a+1]=c[0],renderColors()}}function renderColors(){const a=document.getElementById("colorList");a.innerHTML="",colors.forEach((b,c)=>{const d=c.toString(16).toUpperCase(),e=document.createElement("li");e.style.position="relative",e.style.marginBottom="5px";const f=document.createElement("span");f.textContent=b.toUpperCase(),f.style.position="absolute",f.style.top="50%",f.style.left="50%",f.style.transform="translate(-"+(135-6*d.length)+"px, -50%)",f.style.color=getTextColor(b),f.style.zIndex="1";const g=document.createElement("canvas");g.width=80,g.height=20;const h=g.getContext("2d");h.fillStyle=b,h.fillRect(0,0,g.width,g.height),g.style.borderRadius="5px",g.style.zIndex="0";const i=document.createElement("div");i.style.position="relative",i.style.display="flex",i.style.alignItems="center";const j=document.createElement("span");j.textContent=d,j.style.marginRight="30px",j.style.color="#fff";const k=document.createElement("button");k.textContent="Remove",k.addEventListener("click",()=>removeColor(c));const l=document.createElement("button");l.textContent="Change",l.addEventListener("click",()=>changeColor(c));const m=document.createElement("button");m.textContent="\u2191",m.addEventListener("click",()=>moveColorUp(c));const n=document.createElement("button");n.textContent="\u2193",n.addEventListener("click",()=>moveColorDown(c));const o=document.createElement("button");o.textContent=enabledColorsList[c]?"Disable":"Enable",o.classList.add(enabledColorsList[c]?"enabled":"disabled"),o.addEventListener("click",()=>enableColor(c)),i.appendChild(j),i.appendChild(g),i.appendChild(f),i.appendChild(k),i.appendChild(l),i.appendChild(m),i.appendChild(n),i.appendChild(o),e.appendChild(i),a.appendChild(e)})}function getTextColor(a){const c=parseInt(a.slice(1,3),16),d=parseInt(a.slice(3,5),16),e=parseInt(a.slice(5,7),16);return 128>.2126*c+.7152*d+.0722*e?"white":"black"}function enableColor(a){enabledColorsList[a]=!enabledColorsList[a],renderColors()}function hexToRgb(a){return a.map(a=>{const b=parseInt(a.substring(1,3),16),c=parseInt(a.substring(3,5),16),d=parseInt(a.substring(5,7),16);return[b,c,d]})}function rgbToHex(a){if(!Array.isArray(a)||3!==a.length)throw new Error("Input must be an array of three strings representing RGB values.");return"#"+a.map(a=>{const b=parseInt(a,10);if(isNaN(b)||0>b||255<b)throw new Error(`Invalid RGB component: ${a}. Must be a number between 0 and 255.`);const c=b.toString(16).toUpperCase();return 1===c.length?"0"+c:c}).join("")}function arrayEquals(a,b){return JSON.stringify(a)===JSON.stringify(b)}function addFilter(){if(15>filterList.length){let a;const b=document.getElementById("Filters").value;if("none"!=b){if(filterList.push(b),"custom"==b){const c=""===document.getElementById("red").value?"255":document.getElementById("red").value,d=""===document.getElementById("green").value?"255":document.getElementById("green").value,e=""===document.getElementById("blue").value?"255":document.getElementById("blue").value;a=[c,d,e]}else if("noise"==b){const b=""===document.getElementById("noiseLevel").value?15:document.getElementById("noiseLevel").value;a=[b]}else if("blur"==b){const b=Math.floor(Math.min(Math.abs(document.getElementById("blurPower").value),50));a=[0<b?b:2]}else if("median"==b){const b=Math.floor(Math.min(Math.abs(document.getElementById("blurPower").value),10));a=[0<b?b:2]}else if("Brighten"==b){const b=document.getElementById("Slider").value;a=[b]}else a=[];filterEffectPowerList.push(a)}renderFilterList()}else alert("cannot add more then 15 filters")}function getFilterData(a,b){return console.log(b),"custom"===a?""+rgbToHex(b):"noise"===a?"power: "+b[0]:"blur"===a?"power: "+b[0]:"median"===a?"radius: "+b[0]:"brighten"===a?""+Math.round(100*b[0])+"%":""}function removeFilter(a){filterList.splice(a,1),filterEffectPowerList.splice(a,1),renderFilterList()}function moveUp(a){0<a&&([filterList[a-1],filterList[a]]=[filterList[a],filterList[a-1]],[filterEffectPowerList[a-1],filterEffectPowerList[a]]=[filterEffectPowerList[a],filterEffectPowerList[a-1]],renderFilterList())}function moveDown(a){a<filterList.length-1&&([filterList[a],filterList[a+1]]=[filterList[a+1],filterList[a]],[filterEffectPowerList[a],filterEffectPowerList[a+1]]=[filterEffectPowerList[a+1],filterEffectPowerList[a]],renderFilterList())}function renderFilterList(){const a=document.getElementById("FiltersList");return a?(a.innerHTML="",Array.isArray(filterList)&&Array.isArray(filterEffectPowerList)?void filterList.forEach((b,c)=>{if("string"!=typeof b)return void console.warn(`Invalid filter at index ${c}:`,b);b="UNBLUR"===b.toUpperCase()?"SHARPEN":b;const d=document.createElement("li");d.style.position="relative",d.style.marginBottom="5px",d.style.display="flex",d.style.alignItems="center";const e=document.createElement("span");e.textContent=b.toUpperCase(),e.style.marginRight="10px",e.style.color="#fff",e.style.fontWeight="bold",d.appendChild(e);const f=filterEffectPowerList[c]||"N/A",g=getFilterData?.(b.toLowerCase(),f)||"N/A",h=document.createElement("span");if(g.startsWith("#")){const a=document.createElement("canvas");a.width=80,a.height=20,a.style.marginRight="-70px",a.style.borderRadius="5px",a.style.zIndex="-1";const b=a.getContext("2d");b?(b.fillStyle=g,b.fillRect(0,0,a.width,a.height)):console.warn("Failed to get canvas context for:",g),d.appendChild(a),h.textContent=g,h.style.marginRight="10px",h.style.color=getTextColor?.(g)||"#000",h.style.fontStyle="italic",h.style.position="relative",h.style.zIndex="1"}else h.textContent=g,h.style.marginRight="10px",h.style.color="#ccc",h.style.fontStyle="italic";d.appendChild(h);const i=document.createElement("button");i.textContent="Remove",i.addEventListener("click",()=>removeFilter?.(c)),d.appendChild(i);const j=document.createElement("button");j.textContent="\u2191",j.addEventListener("click",()=>moveUp?.(c)),0===c&&(j.style.display="none"),d.appendChild(j);const k=document.createElement("button");k.textContent="\u2193",k.addEventListener("click",()=>moveDown?.(c)),c===filterList.length-1&&(k.style.display="none"),d.appendChild(k),a.appendChild(d)}):void console.error("filterList and filterEffectPowerList must be arrays.")):void console.error("Element with id \"FiltersList\" not found.")}
