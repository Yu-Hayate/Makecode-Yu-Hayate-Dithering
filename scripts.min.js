let colors=["#ffffff","#ff2121","#ff93c4","#ff8135","#fff609","#249ca3","#78dc52","#003fad","#87f2ff","#8e2ec4","#a4839f","#5c406c","#e5cdc4","#91463d","#000000"];function findNearestColor(t,r){let n=r[0],l=Math.abs(t[0]-n[0])+Math.abs(t[1]-n[1])+Math.abs(t[2]-n[2]);for(let e=1;e<r.length;e++){var[o,a,i]=r[e];(i=Math.abs(t[0]-o)+Math.abs(t[1]-a)+Math.abs(t[2]-i))<l&&(l=i,n=r[e])}return n}function getQuantErr(e,t){return e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e}function applyErrBitShift(e,t,r,n){return r*=multiplier,e[0]+=t[0]*r>>n,e[1]+=t[1]*r>>n,e[2]+=t[2]*r>>n,e}function applyErrDiv(e,t,r,n){return r*=multiplier,n=1/n,e[0]+=t[0]*r*n,e[1]+=t[1]*r*n,e[2]+=t[2]*r*n,e}let enabledColorsList=new Array(colors.length).fill(!0),filterList=[],filterEffectPowerList=[],time=0,multiplier=1;const listKey="$I",defaultColorList={color:colors,enabledColorsList:new Array(colors.length).fill(!0)};function updateMultiplier(){multiplier=parseFloat(document.getElementById("err_multi").value)||1}function processImage(){updateMultiplier();var e=document.getElementById("fileInput"),n=document.getElementById("scaleFactor");const l=document.getElementById("outputImage");document.getElementById("colorArr");var o=document.getElementById("width").value,a=document.getElementById("height").value,i=document.getElementById("maxPixels").value,s=document.getElementById("ditheringOptions").value;const t=new FileReader;t.onload=function(e){const r=new Image;r.onload=function(){const e=document.createElement("canvas"),t=e.getContext("2d");setCanvasSize(r,e,o,a,i,n.value),t.drawImage(r,0,0,e.width,e.height),applyFilter(t,e.width,e.height),applyDithering(t,e.width,e.height,s),l.src=e.toDataURL()},r.src=e.target.result},t.readAsDataURL(e.files[0]);const r=document.getElementById("downloadButton");r.addEventListener("click",downloadImage)}function saveColorList(){var e,t,r=prompt("Enter a name for the color list:");r&&(t={color:colors,enabledColorsList:enabledColorsList},localStorage.setItem(listKey+r,JSON.stringify(t)),e=document.getElementById("colorLists"),(t=document.createElement("option")).text=r,t.value=r,e.add(t),renderColors())}function loadColorList(){var e=document.getElementById("colorLists").value;e!=listKey+"Default"?(e=listKey+e,(e=localStorage.getItem(e))&&(e=JSON.parse(e),colors=e.color,enabledColorsList=e.enabledColorsList)):(colors=defaultColorList.color,enabledColorsList=defaultColorList.enabledColorsList),renderColors()}function removeColorList(){var e=document.getElementById("colorLists").value;if(e!=listKey+"Default"){var t=listKey+e;localStorage.removeItem(t);for(var r=document.getElementById("colorLists"),n=r.options,l=0;l<n.length;l++)if(n[l].value===e){r.remove(l);break}0===r.options.length&&(colors=defaultColorList.color,enabledColorsList=defaultColorList.enabledColorsList,renderColors())}}function setCanvasSize(e,t,r,n,l,o){var a=document.getElementById("sizeSettings").value;"widthHeight"===a?-1!=r||-1!=n?(t.width=-1!=r?r:e.width*(n/e.height),t.height=-1!=n?n:e.height*(r/e.width)):(t.width=e.width,t.height=e.height):"pixelGoal"===a?(l=resizePixelGoal(e.width,e.height,l),t.width=l[0],t.height=l[1]):(t.width=e.width*o,t.height=e.height*o)}function applyDithering(e,t,r,n){"none"==n?noneDithering(e,t,r):"floyd"==n?floydSteinbergDithering(e,t,r):"nearest"==n?ClosesColorDithering(e,t,r):"bayerMatrix4"==n?bayerDithering4x4(e,t,r):"bayerMatrix8"==n?bayerDithering8x8(e,t,r):"falseFloyd"==n?FalseFloydSteinbergDithering(e,t,r):"stucki"==n?stuckiDithering(e,t,r):"Burkes"==n?BurkesDithering(e,t,r):"bayerMatrix2"==n?bayerDithering2x2(e,t,r):"bayerMatrix16"==n&&bayerDithering16x16(e,t,r)}function applyFilter(t,r,n){if(0<filterList.length)for(let e=0;e<filterList.length;e++)"GrayScale"==filterList[e]?grayScale(t,r,n):"custom"==filterList[e]?customFilter(t,r,n,filterEffectPowerList[e][0],filterEffectPowerList[e][1],filterEffectPowerList[e][2]):"noise"==filterList[e]?noiseFilter(t,r,n,filterEffectPowerList[e][0]):"blur"==filterList[e]?blurImage(t,r,n,Math.min(Math.abs(filterEffectPowerList[e][0]),50)):"invert"==filterList[e]?InvertFilter(t,r,n):"unBlur"==filterList[e]?unblurImage(t,r,n):"median"==filterList[e]?(Math.min(Math.abs(filterEffectPowerList[e][0]),15),medianFilter(t,r,n,1)):"Brighten"==filterList[e]&&(Math.max(Math.abs(filterEffectPowerList[e][0]),.1),brightenFilter(t,r,n));else filterType=document.getElementById("Filters").value,"GrayScale"==filterType?grayScale(t,r,n):"custom"==filterType?customFilter(t,r,n,document.getElementById("red").value,document.getElementById("green").value,document.getElementById("blue").value):"noise"==filterType?noiseFilter(t,r,n,document.getElementById("noiseLevel").value):"blur"==filterType?blurImage(t,r,n,Math.min(Math.abs(document.getElementById("blurPower").value),50)):"invert"==filterType?InvertFilter(t,r,n):"unBlur"==filterType?unblurImage(t,r,n):"median"==filterType?medianFilter(t,r,n,Math.min(Math.abs(document.getElementById("radius").value),15)):"Brighten"==filterType&&brightenFilter(t,r,n,Math.max(Math.abs(document.getElementById("Slider")),.1))}function brightenFilter(e,t,r,n){r=e.getImageData(0,0,t,r);const l=r.data;for(let e=0;e<l.length;e+=4){var o=l[e],a=l[e+1],i=l[e+2],o=Math.min(255,o*n),a=Math.min(255,a*n),i=Math.min(255,i*n);l[e]=o,l[e+1]=a,l[e+2]=i}e.putImageData(r,0,0)}function medianFilter(e,l,o,a){var t=e.getImageData(0,0,l,o);const i=t.data,s=new Uint8ClampedArray(i.length);for(let n=0;n<o;n++)for(let r=0;r<l;r++){var d=4*(n*l+r);const h=[],p=[],y=[];for(let t=-a;t<=a;t++)for(let e=-a;e<=a;e++){var c=r+e,g=n+t;0<=c&&c<l&&0<=g&&g<o&&(c=4*(g*l+c),h.push(i[c]),p.push(i[1+c]),y.push(i[2+c]))}h.sort((e,t)=>e-t),p.sort((e,t)=>e-t),y.sort((e,t)=>e-t);var u=h[Math.floor(h.length/2)],m=p[Math.floor(p.length/2)],f=y[Math.floor(y.length/2)];s[d]=u,s[1+d]=m,s[2+d]=f,s[3+d]=i[3+d]}for(let e=0;e<i.length;e++)i[e]=s[e];e.putImageData(t,0,0)}renderColors(),window.onload=function(){var e=document.getElementById("colorLists");e.innerHTML="";var t=document.createElement("option");t.text="Default",t.value=listKey+"Default",e.add(t);for(var r=0;r<localStorage.length;r++){var n,l=localStorage.key(r);l.startsWith(listKey)&&(n=l.substring(listKey.length),(l=document.createElement("option")).text=n,l.value=n,e.add(l))}renderColors()},document.getElementById("Filters").addEventListener("change",function(){var e=this.value,t=document.getElementById("customFilter"),r=document.getElementById("NoiseFilter"),n=document.getElementById("blurFilter"),l=document.getElementById("RadiusFilter"),o=document.getElementById("BrightenFilter");t.style.display="none",r.style.display="none",n.style.display="none",l.style.display="none",o.style.display="none","custom"===e?t.style.display="block":"noise"===e?r.style.display="block":"blur"===e?n.style.display="block":"median"===e?l.style.display="block":"Brighten"===e&&(o.style.display="block"),fliterOption=e}),document.getElementById("sizeSettings").addEventListener("change",function(){var e=this.value;document.getElementById("scaleOptions").style.display="none",document.getElementById("pixelGoalOptions").style.display="none",document.getElementById("widthHeightOptions").style.display="none",document.getElementById(e+"Options").style.display="block"}),document.getElementById("red").addEventListener("input",function(){changeColorPickerColor()}),document.getElementById("green").addEventListener("input",function(){changeColorPickerColor()}),document.getElementById("blue").addEventListener("input",function(){changeColorPickerColor()}),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("ditheringOptions"),r=document.getElementById("hoverBox"),n=document.getElementById("hoverDescription");e.addEventListener("mouseover",function(e){var t;"OPTION"===e.target.tagName&&(t=e.target.getAttribute("data-description"),e=e.target.getBoundingClientRect(),n.textContent=t,r.style.display="block",r.style.left=e.left+"px",r.style.top=e.top+window.scrollY+20+"px")}),e.addEventListener("mouseout",function(){r.style.display="none"})}),document.getElementById("fileInput").addEventListener("change",function(e){e=e.target.files[0];if(e){const a=new Image;a.onload=function(){const e=document.getElementById("width"),t=document.getElementById("height");document.getElementById("maxPixels");const r=document.getElementById("scaleFactor");var n=(window.innerWidth<<2)/14,l=Math.round(n/a.width*1e3)/1e3,o=Math.floor(a.width*l),n=Math.floor(a.height*l);e.value=Math.max(o,1),t.value=Math.max(n,1),r.value=Math.abs(l-1)<=.1?1:l,processImage()};const t=new FileReader;t.onload=function(e){a.src=e.target.result},t.readAsDataURL(e)}});const slider=document.getElementById("Slider"),valueDisplay=document.getElementById("sliderValue");function downloadImage(){var e=document.getElementById("varName").value;const t=document.createElement("a");t.href=outputImage.src,t.download=e+".png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function convertImgStringToCanvas(e){const r=(e=e.replace("`","").replace("img","")).trim().split(/\s{2,}/).map(e=>e.trim());var n=r[0].split(" ").length,l=r.length;const t=document.createElement("canvas"),o=t.getContext("2d");var a=document.getElementById("scaleFactor"),i=parseFloat(a.value),s=document.getElementById("width").value,e=document.getElementById("height").value,a=document.getElementById("maxPixels").value;"widthHeight"===document.getElementById("sizeSettings").value?(t.width=s,t.height=e):"pixelGoal"===document.getElementById("sizeSettings").value?(a=resizePixelGoal(n,l,a),t.width=a[0],t.height=a[1]):(t.width=n*i,t.height=l*i);var d=t.width/n,c=t.height/l;for(let t=0;t<l;t++){var g=r[t].split(" ");for(let e=0;e<n;e++){var u=g[e];"."!==u?(u=parseInt(u,16)-1,u=colors[u],o.fillStyle=u):o.fillStyle="#FFFFFF",o.fillRect(e*d,t*c,d,c)}}return t}function convertAndDownload(){var e=convertImgStringToCanvas(document.getElementById("makeCodeInput").value,colors),t=(e.getContext("2d"),e.toDataURL("image/png")),e=document.createElement("a");e.href=t,e.download=document.getElementById("varName").value+".png",document.body.appendChild(e),e.click(),document.body.removeChild(e)}function changeColorPickerColor(){const e=document.getElementById("colorPicker"),t=parseInt(document.getElementById("red").value),r=parseInt(document.getElementById("green").value),n=parseInt(document.getElementById("blue").value);var l=("0"+t.toString(16)).slice(-2),o=("0"+r.toString(16)).slice(-2),a=("0"+n.toString(16)).slice(-2);e.value="#"+l+o+a}function updateColors(){var e=document.getElementById("colorPicker");const t=document.getElementById("red"),r=document.getElementById("green"),n=document.getElementById("blue"),l=e.value;var o=parseInt(l.substring(1,3),16),a=parseInt(l.substring(3,5),16),e=parseInt(l.substring(5,7),16);t.value=o,r.value=a,n.value=e}function removedisabledColors(t,r){const n=[];for(let e=0;e<t.length;e++)r[e]&&n.push(t[e]);return n}function setRGBValues(e,t,r){document.getElementById("red").value=e,document.getElementById("green").value=t,document.getElementById("blue").value=r}function resizePixelGoal(e,t,r){if(-1==r)return[e,t];t=e/t,r=Math.sqrt(r*t),t=r/t;return[r=Math.round(r),t=Math.round(t)]}function copyToClipboard(){var e=document.getElementById("varName").value;navigator.clipboard.writeText("let "+e+imageString),alert("Copied successfully! ")}function noneDithering(e,r,n){palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);var l=e.getImageData(0,0,r,n).data,o=[];for(let t=0;t<n;t++){var a=[];for(let e=0;e<r;e++){var i=4*(t*r+e),s=l[i],d=l[1+i],i=l[2+i];a.push(palArr.indexOf(findNearestColor([s,d,i],palArr))+1)}o.push(a)}imageString=" = img`\n";for(let e=0;e<o.length;e++){var c=o[e];for(let t=0;t<c.length;t++){let e=c[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`"}function bayerDithering2x2(e,r,n){const t=[[0,2],[3,1]];var l=t[0].length,o=t.length,a=Math.max(...t.flat()),i=removedisabledColors(hexToRgb(colors),enabledColorsList),s=e.getImageData(0,0,r,n);const d=s.data;var c=t.map(e=>e.map(e=>e/a));for(let t=0;t<n;t++)for(let e=0;e<r;e++){var g=4*(t*r+e),u=d[g],m=d[1+g],f=d[2+g],h=c[t%o][e%l]-.5,h=findNearestColor([255*Math.min(Math.max(u/255+h,0),1),255*Math.min(Math.max(m/255+h,0),1),255*Math.min(Math.max(f/255+h,0),1)],i);d[g]=h[0],d[1+g]=h[1],d[2+g]=h[2]}e.putImageData(s,0,0)}function bayerDithering4x4(e,r,n){const t=[[0,8,2,10],[12,4,14,6],[3,11,1,9],[15,7,13,5]];var l=t[0].length,o=t.length,a=Math.max(...t.flat()),i=removedisabledColors(hexToRgb(colors),enabledColorsList),s=e.getImageData(0,0,r,n);const d=s.data;var c=t.map(e=>e.map(e=>e/a));for(let t=0;t<n;t++)for(let e=0;e<r;e++){var g=4*(t*r+e),u=d[g],m=d[1+g],f=d[2+g],h=c[t%o][e%l]-.5,h=findNearestColor([255*Math.min(Math.max(u/255+h,0),1),255*Math.min(Math.max(m/255+h,0),1),255*Math.min(Math.max(f/255+h,0),1)],i);d[g]=h[0],d[1+g]=h[1],d[2+g]=h[2]}e.putImageData(s,0,0)}function bayerDithering8x8(e,r,n){const t=[[0,48,12,60,3,51,15,63],[32,16,44,28,35,19,47,31],[8,56,4,52,11,59,7,55],[40,24,36,20,43,27,39,23],[2,50,14,62,1,49,13,61],[34,18,46,30,33,17,45,29],[10,58,6,54,9,57,5,53],[42,26,38,22,41,25,37,21]];var l=t[0].length,o=t.length,a=Math.max(...t.flat()),i=removedisabledColors(hexToRgb(colors),enabledColorsList),s=e.getImageData(0,0,r,n);const d=s.data;var c=t.map(e=>e.map(e=>e/a));for(let t=0;t<n;t++)for(let e=0;e<r;e++){var g=4*(t*r+e),u=d[g],m=d[1+g],f=d[2+g],h=c[t%o][e%l]-.5,h=findNearestColor([255*Math.min(Math.max(u/255+h,0),1),255*Math.min(Math.max(m/255+h,0),1),255*Math.min(Math.max(f/255+h,0),1)],i);d[g]=h[0],d[1+g]=h[1],d[2+g]=h[2]}e.putImageData(s,0,0)}function bayerDithering16x16(e,r,n){const t=[[0,192,48,240,12,204,60,252,3,195,51,243,15,207,63,255],[128,64,176,112,140,76,188,124,131,67,179,115,143,79,191,127],[32,224,16,208,44,236,28,220,35,227,19,211,47,239,31,223],[160,96,144,80,172,108,156,92,163,99,147,83,175,111,159,95],[8,200,56,248,4,196,52,244,11,203,59,251,7,199,55,247],[136,72,184,120,132,68,180,116,139,75,187,123,142,78,190,126],[40,232,24,216,36,228,20,212,43,235,27,219,39,231,23,215],[168,104,152,88,164,100,148,84,171,107,155,91,167,103,151,87],[2,194,50,242,14,206,62,254,1,193,49,241,13,205,61,253],[130,66,178,114,129,65,177,113,134,70,182,118,133,69,181,117],[34,226,18,210,46,238,30,222,33,225,17,209,45,237,29,221],[162,98,146,82,174,110,158,94,161,97,145,81,173,109,157,93],[10,202,58,250,6,198,54,246,9,201,57,249,5,197,53,245],[138,74,186,122,137,73,185,121,140,76,188,124,141,77,189,125],[42,234,26,218,38,230,22,214,41,233,25,217,37,229,21,213],[170,106,154,90,166,102,150,86,169,105,153,89,165,101,149,85]];var l=t[0].length,o=t.length,a=Math.max(...t.flat()),i=removedisabledColors(hexToRgb(colors),enabledColorsList),s=e.getImageData(0,0,r,n);const d=s.data;var c=t.map(e=>e.map(e=>e/a));for(let t=0;t<n;t++)for(let e=0;e<r;e++){var g=4*(t*r+e),u=d[g],m=d[1+g],f=d[2+g],h=c[t%o][e%l]-.5,h=findNearestColor([255*Math.min(Math.max(u/255+h,0),1),255*Math.min(Math.max(m/255+h,0),1),255*Math.min(Math.max(f/255+h,0),1)],i);d[g]=h[0],d[1+g]=h[1],d[2+g]=h[2]}e.putImageData(s,0,0)}function ClosesColorDithering(e,t,r){var n=e.getImageData(0,0,t,r),l=n.data,o=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var a=0;a<r;a++){for(var i=[],s=0;s<t;s++){var d=4*(a*t+s);oldpixel=[l[d],l[1+d],l[2+d]],newpixel=findNearestColor(oldpixel,palArr),i.push(palArr.indexOf(newpixel)+1),l[d]=newpixel[0],l[1+d]=newpixel[1],l[2+d]=newpixel[2],l[3+d]=255}o.push(i)}imageString=" = img`\n";for(let e=0;e<o.length;e++){var c=o[e];for(let t=0;t<c.length;t++){let e=c[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`",e.putImageData(n,0,0)}function floydSteinbergDithering(e,t,r){var n=e.getImageData(0,0,t,r),l=n.data,o=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var a=0;a<r;a++){for(var i=[],s=0;s<t;s++){var d=4*(a*t+s);oldpixel=[l[d],l[d+1],l[d+2]],newpixel=findNearestColor(oldpixel,palArr),i.push(palArr.indexOf(newpixel)+1),l[d]=newpixel[0],l[d+1]=newpixel[1],l[d+2]=newpixel[2],l[d+3]=255,quantErr=getQuantErr(oldpixel,newpixel),(d=4*(a*t+(s+1)))<l.length&&(err=applyErrBitShift([l[d],l[d+1],l[d+2]],quantErr,7,4),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+(s-1)))<l.length&&(err=applyErrBitShift([l[d],l[d+1],l[d+2]],quantErr,3,4),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+s))<l.length&&(err=applyErrBitShift([l[d],l[d+1],l[d+2]],quantErr,5,4),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+(s+1)))<l.length&&(err=applyErrBitShift([l[d],l[d+1],l[d+2]],quantErr,1,4),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2])}o.push(i)}imageString=" = img`\n";for(let e=0;e<o.length;e++){var c=o[e];for(let t=0;t<c.length;t++){let e=c[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`",e.putImageData(n,0,0)}function FalseFloydSteinbergDithering(e,t,r){var n=e.getImageData(0,0,t,r),l=n.data,o=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var a=0;a<r;a++){for(var i=[],s=0;s<t;s++){var d=4*(a*t+s);oldpixel=[l[d],l[d+1],l[d+2]],newpixel=findNearestColor(oldpixel,palArr),i.push(palArr.indexOf(newpixel)+1),l[d]=newpixel[0],l[d+1]=newpixel[1],l[d+2]=newpixel[2],l[d+3]=255,quantErr=getQuantErr(oldpixel,newpixel),(d=4*(a*t+(s+1)))<l.length&&(err=applyErrBitShift([l[d],l[d+1],l[d+2]],quantErr,3,3),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+(s+1)))<l.length&&(err=applyErrBitShift([l[d],l[d+1],l[d+2]],quantErr,2,3),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+s))<l.length&&(err=applyErrBitShift([l[d],l[d+1],l[d+2]],quantErr,3,3),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2])}o.push(i)}imageString=" = img`\n";for(let e=0;e<o.length;e++){var c=o[e];for(let t=0;t<c.length;t++){let e=c[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`",e.putImageData(n,0,0)}function stuckiDithering(e,t,r){var n=e.getImageData(0,0,t,r),l=n.data,o=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var a=0;a<r;a++){for(var i=[],s=0;s<t;s++){var d=4*(a*t+s);oldpixel=[l[d],l[d+1],l[d+2]],newpixel=findNearestColor(oldpixel,palArr),i.push(palArr.indexOf(newpixel)+1),l[d]=newpixel[0],l[d+1]=newpixel[1],l[d+2]=newpixel[2],l[d+3]=255,quantErr=getQuantErr(oldpixel,newpixel),(d=4*(a*t+(s+1)))<l.length&&(err=applyErrDiv([l[d],l[d+1],l[d+2]],quantErr,8,42),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*(a*t+(s+2)))<l.length&&(err=applyErrDiv([l[d],l[d+1],l[d+2]],quantErr,4,42),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+(s-2)))<l.length&&(err=applyErrDiv([l[d],l[d+1],l[d+2]],quantErr,2,42),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+(s-1)))<l.length&&(err=applyErrDiv([l[d],l[d+1],l[d+2]],quantErr,4,42),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+s))<l.length&&(err=applyErrDiv([l[d],l[d+1],l[d+2]],quantErr,8,42),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+(s+1)))<l.length&&(err=applyErrDiv([l[d],l[d+1],l[d+2]],quantErr,4,42),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+(s+2)))<l.length&&(err=applyErrDiv([l[d],l[d+1],l[d+2]],quantErr,2,42),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+2)*t+(s-2)))<l.length&&(err=applyErrDiv([l[d],l[d+1],l[d+2]],quantErr,1,42),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+2)*t+(s-1)))<l.length&&(err=applyErrDiv([l[d],l[d+1],l[d+2]],quantErr,2,42),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+2)*t+s))<l.length&&(err=applyErrDiv([l[d],l[d+1],l[d+2]],quantErr,4,42),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+2)*t+(s+1)))<l.length&&(err=applyErrDiv([l[d],l[d+1],l[d+2]],quantErr,2,42),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+2)*t+(s+2)))<l.length&&(err=applyErrDiv([l[d],l[d+1],l[d+2]],quantErr,1,42),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2])}o.push(i)}imageString=" = img`\n";for(let e=0;e<o.length;e++){var c=o[e];for(let t=0;t<c.length;t++){let e=c[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`",e.putImageData(n,0,0)}function BurkesDithering(e,t,r){var n=e.getImageData(0,0,t,r),l=n.data,o=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var a=0;a<r;a++){for(var i=[],s=0;s<t;s++){var d=4*(a*t+s);oldpixel=[l[d],l[d+1],l[d+2]],newpixel=findNearestColor(oldpixel,palArr),i.push(palArr.indexOf(newpixel)+1),l[d]=newpixel[0],l[d+1]=newpixel[1],l[d+2]=newpixel[2],l[d+3]=255,quantErr=getQuantErr(oldpixel,newpixel),(d=4*(a*t+(s+1)))<l.length&&(err=applyErrBitShift([l[d],l[d+1],l[d+2]],quantErr,8,5),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*(a*t+(s+2)))<l.length&&(err=applyErrBitShift([l[d],l[d+1],l[d+2]],quantErr,4,5),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+(s-2)))<l.length&&(err=applyErrBitShift([l[d],l[d+1],l[d+2]],quantErr,2,5),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+(s-1)))<l.length&&(err=applyErrBitShift([l[d],l[d+1],l[d+2]],quantErr,4,5),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+s))<l.length&&(err=applyErrBitShift([l[d],l[d+1],l[d+2]],quantErr,8,5),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+(s+1)))<l.length&&(err=applyErrBitShift([l[d],l[d+1],l[d+2]],quantErr,4,5),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2]),(d=4*((a+1)*t+(s+2)))<l.length&&(err=applyErrBitShift([l[d],l[d+1],l[d+2]],quantErr,2,5),l[d]=err[0],l[d+1]=err[1],l[d+2]=err[2])}o.push(i)}imageString=" = img`\n";for(let e=0;e<o.length;e++){var c=o[e];for(let t=0;t<c.length;t++){let e=c[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`",e.putImageData(n,0,0)}function InvertFilter(e,t,r){r=e.getImageData(0,0,t,r);const n=r.data;for(let e=0;e<n.length;e+=4){var l=n[e],o=n[e+1],a=n[e+2];n[e]=255-l,n[e+1]=255-o,n[e+2]=255-a}e.putImageData(r,0,0)}function noiseFilter(e,t,r,n){r=e.getImageData(0,0,t,r);const l=r.data;for(let e=0;e<l.length;e+=4){var o=l[e],a=l[e+1],i=l[e+2],s=[o+Math.random()*n,a+Math.random()*n,i+Math.random()*n];l[e]=Math.floor((o+s[0])/2),l[e+1]=Math.floor((a+s[1])/2),l[e+2]=Math.floor((i+s[2])/2)}e.putImageData(r,0,0)}function customFilter(e,t,r,n,l,o){r=e.getImageData(0,0,t,r);const a=r.data;for(let e=0;e<a.length;e+=4){var i=a[e],s=a[e+1],d=a[e+2],c=n/255,g=l/255,u=o/255;a[e]=c*i,a[e+1]=g*s,a[e+2]=u*d}e.putImageData(r,0,0)}function grayScale(e,t,r){r=e.getImageData(0,0,t,r);const n=r.data;for(let e=0;e<n.length;e+=4){var l=(n[e]+n[e+1]+n[e+2])/3;n[e]=l,n[e+1]=l,n[e+2]=l}e.putImageData(r,0,0)}function blurImage(e,s,d,t){var r=e.getImageData(0,0,s,d);const c=r.data;var g=Math.floor(t/2),t=2*g+1,u=1/Math.pow(t,2);const m=new Uint8ClampedArray(c.length);for(let i=0;i<d;i++)for(let a=0;a<s;a++){let r=0,n=0,l=0,o=0;for(let t=-g;t<=g;t++)for(let e=-g;e<=g;e++){var f=i+t,h=a+e;0<=f&&f<d&&0<=h&&h<s&&(h=4*(f*s+h),r+=c[h]*u,n+=c[1+h]*u,l+=c[2+h]*u,o+=c[3+h]*u)}var p=4*(i*s+a);m[p]=r,m[1+p]=n,m[2+p]=l,m[3+p]=o}for(let e=0;e<m.length;e++)c[e]=m[e];e.putImageData(r,0,0)}function unblurImage(e,l,o){var a=[[0,-1,0],[-1,5,-1],[0,-1,0]],t=e.getImageData(0,0,l,o);const i=t.data,s=new Uint8ClampedArray(i.length);for(let n=0;n<o;n++)for(let r=0;r<l;r++){var d=4*(n*l+r);const f=[0,0,0];for(let t=-1;t<=1;t++)for(let e=-1;e<=1;e++){var c,g=a[t+1][e+1],u=r+e,m=n+t;0<=u&&u<l&&0<=m&&m<o&&(c=4*(m*l+u),m=i[c],u=i[1+c],c=i[2+c],f[0]+=m*g,f[1]+=u*g,f[2]+=c*g)}s[d]=f[0],s[1+d]=f[1],s[2+d]=f[2],s[3+d]=i[3+d]}for(let e=0;e<i.length;e++)i[e]=s[e];e.putImageData(t,0,0)}function addColor(){const e=document.getElementById("colorInput");var t=e.value.trim();t&&(colors.push(t),enabledColorsList.push(!0),renderColors())}function changeColor(e){const t=document.getElementById("colorInput");var r=t.value.trim();colors[e]=r,renderColors()}function removeColor(e){colors.splice(e,1),enabledColorsList.splice(e,1),renderColors()}function moveColorUp(e){var t;0<e&&(t=[colors[e],colors[e-1]],colors[e]=t[1],colors[e-1]=t[0],t=[enabledColorsList[e],enabledColorsList[e-1]],enabledColorsList[e]=t[1],enabledColorsList[e-1]=t[0],renderColors())}function moveColorDown(e){var t;e<colors.length-1&&(t=[colors[e],colors[e+1]],colors[e]=t[1],colors[e+1]=t[0],t=[enabledColorsList[e],enabledColorsList[e+1]],enabledColorsList[e]=t[1],enabledColorsList[e+1]=t[0],renderColors())}function renderColors(){const f=document.getElementById("colorList");f.innerHTML="",colors.forEach((e,t)=>{var r=t.toString(16).toUpperCase();const n=document.createElement("li");n.style.position="relative",n.style.marginBottom="5px";const l=document.createElement("span");l.textContent=e.toUpperCase(),l.style.position="absolute",l.style.top="50%",l.style.left="50%",l.style.transform="translate(-"+(135-6*r.length)+"px, -50%)",l.style.color=getTextColor(e),l.style.zIndex="1";const o=document.createElement("canvas");o.width=80,o.height=20;const a=o.getContext("2d");a.fillStyle=e,a.fillRect(0,0,o.width,o.height),o.style.borderRadius="5px",o.style.zIndex="0";const i=document.createElement("div");i.style.position="relative",i.style.display="flex",i.style.alignItems="center";const s=document.createElement("span");s.textContent=r,s.style.marginRight="30px",s.style.color="#fff";const d=document.createElement("button");d.textContent="Remove",d.addEventListener("click",()=>removeColor(t));const c=document.createElement("button");c.textContent="Change",c.addEventListener("click",()=>changeColor(t));const g=document.createElement("button");g.textContent="↑",g.addEventListener("click",()=>moveColorUp(t));const u=document.createElement("button");u.textContent="↓",u.addEventListener("click",()=>moveColorDown(t));const m=document.createElement("button");m.textContent=enabledColorsList[t]?"Disable":"Enable",m.classList.add(enabledColorsList[t]?"enabled":"disabled"),m.addEventListener("click",()=>enableColor(t)),i.appendChild(s),i.appendChild(o),i.appendChild(l),i.appendChild(d),i.appendChild(c),i.appendChild(g),i.appendChild(u),i.appendChild(m),n.appendChild(i),f.appendChild(n)})}function getTextColor(e){return.2126*parseInt(e.slice(1,3),16)+.7152*parseInt(e.slice(3,5),16)+.0722*parseInt(e.slice(5,7),16)<128?"white":"black"}function enableColor(e){enabledColorsList[e]=!enabledColorsList[e],renderColors()}function hexToRgb(e){return e.map(e=>{return[parseInt(e.substring(1,3),16),parseInt(e.substring(3,5),16),parseInt(e.substring(5,7),16)]})}function rgbToHex(e){if(!Array.isArray(e)||3!==e.length)throw new Error("Input must be an array of three strings representing RGB values.");return"#"+e.map(e=>{const t=parseInt(e,10);if(isNaN(t)||t<0||255<t)throw new Error("Invalid RGB component: "+e+". Must be a number between 0 and 255.");e=t.toString(16).toUpperCase();return 1===e.length?"0"+e:e}).join("")}function arrayEquals(e,t){return JSON.stringify(e)===JSON.stringify(t)}function addFilter(){if(filterList.length<15){let e;var t,r=document.getElementById("Filters").value;"none"!=r&&(filterList.push(r),e="custom"==r?[""!==document.getElementById("red").value?document.getElementById("red").value:"255",""!==document.getElementById("green").value?document.getElementById("green").value:"255",""!==document.getElementById("blue").value?document.getElementById("blue").value:"255"]:"noise"==r?[""!==document.getElementById("noiseLevel").value?document.getElementById("noiseLevel").value:15]:"blur"==r?[0<(t=Math.floor(Math.min(Math.abs(document.getElementById("blurPower").value),50)))?t:2]:"median"==r?[0<(t=Math.floor(Math.min(Math.abs(document.getElementById("blurPower").value),10)))?t:2]:"Brighten"==r?[document.getElementById("Slider").value]:[],filterEffectPowerList.push(e)),renderFilterList()}else alert("cannot add more then 15 filters")}function getFilterData(e,t){switch(console.log(t),e){case"custom":return""+rgbToHex(t);case"noise":case"blur":return"power: "+t[0];case"median":return"radius: "+t[0];case"brighten":return Math.round(100*t[0])+"%"}return""}function removeFilter(e){filterList.splice(e,1),filterEffectPowerList.splice(e,1),renderFilterList()}function moveUp(e){0<e&&([filterList[e-1],filterList[e]]=[filterList[e],filterList[e-1]],[filterEffectPowerList[e-1],filterEffectPowerList[e]]=[filterEffectPowerList[e],filterEffectPowerList[e-1]],renderFilterList())}function moveDown(e){e<filterList.length-1&&([filterList[e],filterList[e+1]]=[filterList[e+1],filterList[e]],[filterEffectPowerList[e],filterEffectPowerList[e+1]]=[filterEffectPowerList[e+1],filterEffectPowerList[e]],renderFilterList())}function renderFilterList(){const u=document.getElementById("FiltersList");u?(u.innerHTML="",Array.isArray(filterList)&&Array.isArray(filterEffectPowerList)?filterList.forEach((e,t)=>{if("string"==typeof e){e="UNBLUR"===e.toUpperCase()?"SHARPEN":e;const n=document.createElement("li");n.style.position="relative",n.style.marginBottom="5px",n.style.display="flex",n.style.alignItems="center";const l=document.createElement("span");l.textContent=e.toUpperCase(),l.style.marginRight="10px",l.style.color="#fff",l.style.fontWeight="bold",n.appendChild(l);var r=filterEffectPowerList[t]||"N/A";const o=getFilterData(e.toLowerCase(),r)||"N/A",a=document.createElement("span");if(o.startsWith("#")){const c=document.createElement("canvas");c.width=80,c.height=20,c.style.marginRight="-70px",c.style.borderRadius="5px",c.style.zIndex="-1";const g=c.getContext("2d");g?(g.fillStyle=o,g.fillRect(0,0,c.width,c.height)):console.warn("Failed to get canvas context for:",o),n.appendChild(c),a.textContent=o,a.style.marginRight="10px",a.style.color=getTextColor(o)||"#000",a.style.fontStyle="italic",a.style.position="relative",a.style.zIndex="1"}else a.textContent=o,a.style.marginRight="10px",a.style.color="#ccc",a.style.fontStyle="italic";n.appendChild(a);const i=document.createElement("button");i.textContent="Remove",i.addEventListener("click",()=>removeFilter(t)),n.appendChild(i);const s=document.createElement("button");s.textContent="↑",s.addEventListener("click",()=>moveUp(t)),0===t&&(s.style.display="none"),n.appendChild(s);const d=document.createElement("button");d.textContent="↓",d.addEventListener("click",()=>moveDown(t)),t===filterList.length-1&&(d.style.display="none"),n.appendChild(d),u.appendChild(n)}else console.warn("Invalid filter at index "+t+" : ",e)}):console.error("filterList and filterEffectPowerList must be arrays.")):console.error('Element with id "FiltersList" not found.')}slider.addEventListener("input",function(){var e=(100*slider.value).toFixed(0);valueDisplay.textContent=e+"%"});const tools={colors:function(t=255,r=0){colors=[],enabledColorsList=[],colors.push("#ffffff"),colors.push("#000000"),enabledColorsList.push(!0),enabledColorsList.push(!0);for(let e=0;e<t-1;e++){var n=this.getRandomColor(r);colors.push(n),enabledColorsList.push(!0)}renderColors()},getRandomColor:function(e=0){let t=["#"];var r=Math.floor(16*Math.random()).toString(16);if(0===e)for(let e=0;e<6;e++)t.push(Math.floor(16*Math.random()).toString(16));else if(1===e)for(let e=0;e<6;e++)t.push(r);return t.join("")},filters:function(){console.log(JSON.stringify(filterList)+" ; "+JSON.stringify(filterEffectPowerList))}};
