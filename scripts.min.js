let colors=rgbToHex([[255,255,255],[255,33,33],[255,147,196],[255,129,53],[255,246,9],[36,156,163],[120,220,82],[0,63,173],[135,242,255],[142,46,196],[164,131,159],[92,64,108],[229,205,196],[145,70,61],[0,0,0]]),enabledColorsList=new Array(colors.length).fill(!0),filterList=[],filterEffectPowerList=[],time=0;renderColors();const easterEggHTMLBtnDiv=document.getElementById("goToEgg");let currentValue=Number(localStorage.getItem("easterEgg"))||0;easterEggHTMLBtnDiv.style.display="none",1e3<=currentValue&&(easterEggHTMLBtnDiv.style.display="block");let multiplier=1;function updateMultiplier(){multiplier=parseFloat(document.getElementById("err_multi").value)||1}function processImage(){const e=document.getElementById("conv_time");e&&(e.textContent="Conversion Time: Calculating...");var t=performance.now();updateMultiplier();var r=document.getElementById("fileInput"),n=document.getElementById("scaleFactor"),l=parseFloat(n.value);const o=document.getElementById("outputImage");document.getElementById("colorArr");var a=document.getElementById("width").value,i=document.getElementById("height").value,s=document.getElementById("maxPixels").value,g=document.getElementById("ditheringOptions").value;const d=new FileReader;d.onload=function(e){const n=new Image;n.onload=function(){const e=document.createElement("canvas"),t=e.getContext("2d");var r;"widthHeight"===document.getElementById("sizeSettings").value?-1!=a||-1!=i?(e.width=-1!=a?a:n.width*(i/n.height),e.height=-1!=i?i:n.height*(a/n.width)):(e.width=n.width,e.height=n.height):"pixelGoal"===document.getElementById("sizeSettings").value?(r=resizePixelGoal(n.width,n.height,s),e.width=r[0],e.height=r[1]):(e.width=n.width*l,e.height=n.height*l);t.drawImage(n,0,0,e.width,e.height),applyFliter(t,e.width,e.height),applyDithering(t,e.width,e.height,g),o.src=e.toDataURL()},n.src=e.target.result},d.readAsDataURL(r.files[0]);const u=document.getElementById("downloadButton");u.addEventListener("click",downloadImage);r=performance.now();time=r-t,time=Math.round(1e10*time)/1e10,e&&(e.textContent="Conversion Time: "+time+"ms")}function applyDithering(e,t,r,n){"none"==n?noneDithering(e,t,r):"floyd"==n?floydSteinbergDithering(e,t,r):"nearest"==n?ClosesColorDithering(e,t,r):"bayerMatrix4"==n?brayerDithering4x4(e,t,r):"bayerMatrix8"==n?brayerDithering8x8(e,t,r):"falseFloyd"==n?FalseFloydSteinbergDithering(e,t,r):"stucki"==n?stuckiDithering(e,t,r):"Burkes"==n?BurkesDithering(e,t,r):"bayerMatrix2"==n?brayerDithering2x2(e,t,r):"bayerMatrix16"==n&&brayerDithering16x16(e,t,r)}function applyFliter(t,r,n){if(0<filterList.length)for(let e=0;e<filterList.length;e++)"GrayScale"==filterList[e]?grayScale(t,r,n):"custom"==filterList[e]?customFilter(t,r,n,filterEffectPowerList[e][0],filterEffectPowerList[e][1],filterEffectPowerList[e][2]):"noise"==filterList[e]?noiseFilter(t,r,n,filterEffectPowerList[e][0]):"blur"==filterList[e]?blurImage(t,r,n,Math.min(Math.abs(filterEffectPowerList[e][0]),50)):"invert"==filterList[e]?InvertFilter(t,r,n):"unBlur"==filterList[e]?unblurImage(t,r,n):"median"==filterList[e]&&(Math.min(Math.abs(filterEffectPowerList[e][0]),15),medianFilter(t,r,n,1));else filterType=document.getElementById("Filters").value,"GrayScale"==filterType?grayScale(t,r,n):"custom"==filterType?customFilter(t,r,n,document.getElementById("red").value,document.getElementById("green").value,document.getElementById("blue").value):"noise"==filterType?noiseFilter(t,r,n,document.getElementById("noiseLevel").value):"blur"==filterType?blurImage(t,r,n,Math.min(Math.abs(document.getElementById("blurPower").value),50)):"invert"==filterType?InvertFilter(t,r,n):"unBlur"==filterType?unblurImage(t,r,n):"median"==filterType&&medianFilter(t,r,n,Math.min(Math.abs(document.getElementById("radius").value),15))}function medianFilter(e,l,o,a){var t=e.getImageData(0,0,l,o);const i=t.data,s=new Uint8ClampedArray(i.length);for(let n=0;n<o;n++)for(let r=0;r<l;r++){var g=4*(n*l+r);const h=[],f=[],v=[];for(let t=-a;t<=a;t++)for(let e=-a;e<=a;e++){var d=r+e,u=n+t;0<=d&&d<l&&0<=u&&u<o&&(d=4*(u*l+d),h.push(i[d]),f.push(i[1+d]),v.push(i[2+d]))}h.sort((e,t)=>e-t),f.sort((e,t)=>e-t),v.sort((e,t)=>e-t);var c=h[Math.floor(h.length/2)],m=f[Math.floor(f.length/2)],p=v[Math.floor(v.length/2)];s[g]=c,s[1+g]=m,s[2+g]=p,s[3+g]=i[3+g]}for(let e=0;e<i.length;e++)i[e]=s[e];e.putImageData(t,0,0)}var defaultColorList={color:rgbToHex([[255,255,255],[255,33,33],[255,147,196],[255,129,53],[255,246,9],[36,156,163],[120,220,82],[0,63,173],[135,242,255],[142,46,196],[164,131,159],[92,64,108],[229,205,196],[145,70,61],[0,0,0]]),enabledColorsList:[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]};function saveColorList(){var e,t,r=prompt("Enter a name for the color list:");r&&(t={color:colors,enabledColorsList:enabledColorsList},localStorage.setItem(r,JSON.stringify(t)),e=document.getElementById("colorLists"),(t=document.createElement("option")).text=r,t.value=r,e.add(t),renderColors())}function loadColorList(){var e=document.getElementById("colorLists").value;"default"!==e?(e=localStorage.getItem(e))&&(e=JSON.parse(e),colors=e.color,enabledColorsList=e.enabledColorsList):(colors=defaultColorList.color,enabledColorsList=defaultColorList.enabledColorsList),console.log(colors),console.log(enabledColorsList),renderColors()}function removeColorList(){var e=document.getElementById("colorLists").value;if("default"!==e){localStorage.removeItem(e);for(var t=document.getElementById("colorLists"),r=t.options,n=0;n<r.length;n++)if(r[n].value===e){t.remove(n);break}renderColors()}}function downloadImage(){var e=document.getElementById("varName").value;const t=document.createElement("a");t.href=outputImage.src,t.download=e+".png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function convertImgStringToCanvas(e){const r=(e=e.replace("`","").replace("img","")).trim().split(/\s{2,}/).map(e=>e.trim());var n=r[0].split(" ").length,l=r.length;const t=document.createElement("canvas"),o=t.getContext("2d");var a=document.getElementById("scaleFactor"),i=parseFloat(a.value),s=document.getElementById("width").value,e=document.getElementById("height").value,a=document.getElementById("maxPixels").value;"widthHeight"===document.getElementById("sizeSettings").value?(t.width=s,t.height=e):"pixelGoal"===document.getElementById("sizeSettings").value?(a=resizePixelGoal(n,l,a),t.width=a[0],t.height=a[1]):(t.width=n*i,t.height=l*i);var g=t.width/n,d=t.height/l;for(let t=0;t<l;t++){var u=r[t].split(" ");for(let e=0;e<n;e++){var c=u[e];"."!==c?(c=parseInt(c,16)-1,c=colors[c],o.fillStyle=c):o.fillStyle="#FFFFFF",o.fillRect(e*g,t*d,g,d)}}return t}function convertAndDownload(){var e=convertImgStringToCanvas(document.getElementById("makeCodeInput").value,colors),t=(e.getContext("2d"),e.toDataURL("image/png")),e=document.createElement("a");e.href=t,e.download=document.getElementById("varName").value+".png",document.body.appendChild(e),e.click(),document.body.removeChild(e)}function changeColorPickerColor(){const e=document.getElementById("colorPicker"),t=parseInt(document.getElementById("red").value),r=parseInt(document.getElementById("green").value),n=parseInt(document.getElementById("blue").value);var l=("0"+t.toString(16)).slice(-2),o=("0"+r.toString(16)).slice(-2),a=("0"+n.toString(16)).slice(-2);e.value="#"+l+o+a}function updateColors(){var e=document.getElementById("colorPicker");const t=document.getElementById("red"),r=document.getElementById("green"),n=document.getElementById("blue"),l=e.value;var o=parseInt(l.substring(1,3),16),a=parseInt(l.substring(3,5),16),e=parseInt(l.substring(5,7),16);t.value=o,r.value=a,n.value=e}function removedisabledColors(t,r){const n=[];for(let e=0;e<t.length;e++)r[e]&&n.push(t[e]);return n}function setRGBValues(e,t,r){document.getElementById("red").value=e,document.getElementById("green").value=t,document.getElementById("blue").value=r}function resizePixelGoal(e,t,r){if(-1==r)return[e,t];t=e/t,r=Math.sqrt(r*t),t=r/t;return[r=Math.round(r),t=Math.round(t)]}function copyToClipboard(){var e=document.getElementById("varName").value;navigator.clipboard.writeText("let "+e+imageString),alert("Copied successfully! ")}function noneDithering(e,r,n){palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);var l=e.getImageData(0,0,r,n).data,o=[];for(let t=0;t<n;t++){var a=[];for(let e=0;e<r;e++){var i=4*(t*r+e),s=l[i],g=l[1+i],i=l[2+i];a.push(palArr.indexOf(findClosest([s,g,i],palArr))+1)}o.push(a)}imageString=" = img`\n";for(let e=0;e<o.length;e++){var d=o[e];for(let t=0;t<d.length;t++){let e=d[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`"}function brayerDithering2x2(e,r,n){var l=[[0,2],[3,1]];const o=removedisabledColors(hexToRgb(colors),enabledColorsList);var t=e.getImageData(0,0,r,n);const a=t.data,i=[];for(let t=0;t<n;t++){const p=[];for(let e=0;e<r;e++){var s=4*(t*r+e),g=a[s],d=a[1+s],u=a[2+s],c=l[e%2][t%2]/3,u=findClosest([255*c<g?255:0,255*c<d?255:0,255*c<u?255:0],o);a[s]=u[0],a[1+s]=u[1],a[2+s]=u[2],p.push(o.indexOf(u)+1)}i.push(p)}imageString=" = img`\n";for(let e=0;e<i.length;e++){var m=i[e];for(let t=0;t<m.length;t++){let e=m[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`",e.putImageData(t,0,0)}function brayerDithering4x4(e,r,n){var l=[[0,8,2,10],[12,4,14,6],[3,11,1,9],[15,7,13,5]];const o=removedisabledColors(hexToRgb(colors),enabledColorsList);var t=e.getImageData(0,0,r,n);const a=t.data,i=[];for(let t=0;t<n;t++){const p=[];for(let e=0;e<r;e++){var s=4*(t*r+e),g=a[s],d=a[1+s],u=a[2+s],c=l[e%4][t%4]/15,u=findClosest([255*c<g?255:0,255*c<d?255:0,255*c<u?255:0],o);a[s]=u[0],a[1+s]=u[1],a[2+s]=u[2],p.push(o.indexOf(u)+1)}i.push(p)}imageString=" = img`\n";for(let e=0;e<i.length;e++){var m=i[e];for(let t=0;t<m.length;t++){let e=m[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`",e.putImageData(t,0,0)}function brayerDithering8x8(e,r,n){var l=[[0,48,12,60,3,51,15,63],[32,16,44,28,35,19,47,31],[8,56,4,52,11,59,7,55],[40,24,36,20,43,27,39,23],[2,50,14,62,1,49,13,61],[34,18,46,30,33,17,45,29],[10,58,6,54,9,57,5,53],[42,26,38,22,41,25,37,21]];const o=removedisabledColors(hexToRgb(colors),enabledColorsList);var t=e.getImageData(0,0,r,n);const a=t.data,i=[];for(let t=0;t<n;t++){const p=[];for(let e=0;e<r;e++){var s=4*(t*r+e),g=a[s],d=a[1+s],u=a[2+s],c=l[e%8][t%8]/63,u=findClosest([255*c<g?255:0,255*c<d?255:0,255*c<u?255:0],o);a[s]=u[0],a[1+s]=u[1],a[2+s]=u[2],p.push(o.indexOf(u)+1)}i.push(p)}imageString=" = img`\n";for(let e=0;e<i.length;e++){var m=i[e];for(let t=0;t<m.length;t++){let e=m[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`",e.putImageData(t,0,0)}function easterEgg(){var e=Number(localStorage.getItem("easterEgg"))||0;e++,localStorage.setItem("easterEgg",e),100==e||1e3==e?window.location.href="easterEgg.html":console.log(e)}function goToeasterEgg(){window.location.href="easterEgg.html"}function brayerDithering16x16(e,r,n){var l=[[0,192,48,240,12,204,60,252,3,195,51,243,15,207,63,255],[128,64,176,112,140,76,188,124,131,67,179,115,143,79,191,127],[32,224,16,208,44,236,28,220,35,227,19,211,47,239,31,223],[160,96,144,80,172,108,156,92,163,99,147,83,175,111,159,95],[8,200,56,248,4,196,52,244,11,203,59,251,7,199,55,247],[136,72,184,120,132,68,180,116,139,75,187,123,142,78,190,126],[40,232,24,216,36,228,20,212,43,235,27,219,39,231,23,215],[168,104,152,88,164,100,148,84,171,107,155,91,167,103,151,87],[2,194,50,242,14,206,62,254,1,193,49,241,13,205,61,253],[130,66,178,114,129,65,177,113,134,70,182,118,133,69,181,117],[34,226,18,210,46,238,30,222,33,225,17,209,45,237,29,221],[162,98,146,82,174,110,158,94,161,97,145,81,173,109,157,93],[10,202,58,250,6,198,54,246,9,201,57,249,5,197,53,245],[138,74,186,122,137,73,185,121,140,76,188,124,141,77,189,125],[42,234,26,218,38,230,22,214,41,233,25,217,37,229,21,213],[170,106,154,90,166,102,150,86,169,105,153,89,165,101,149,85]];const o=removedisabledColors(hexToRgb(colors),enabledColorsList);var t=e.getImageData(0,0,r,n);const a=t.data,i=[];for(let t=0;t<n;t++){const p=[];for(let e=0;e<r;e++){var s=4*(t*r+e),g=a[s],d=a[1+s],u=a[2+s],c=l[e%16][t%16]/255,u=findClosest([255*c<g?255:0,255*c<d?255:0,255*c<u?255:0],o);a[s]=u[0],a[1+s]=u[1],a[2+s]=u[2],p.push(o.indexOf(u)+1)}i.push(p)}imageString=" = img`\n";for(let e=0;e<i.length;e++){var m=i[e];for(let t=0;t<m.length;t++){let e=m[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`",e.putImageData(t,0,0)}function ClosesColorDithering(e,t,r){var n=e.getImageData(0,0,t,r),l=n.data,o=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var a=0;a<r;a++){for(var i=[],s=0;s<t;s++){var g=4*(a*t+s);oldpixel=[l[g],l[1+g],l[2+g]],newpixel=findClosest(oldpixel,palArr),i.push(palArr.indexOf(newpixel)+1),l[g]=newpixel[0],l[1+g]=newpixel[1],l[2+g]=newpixel[2],l[3+g]=255}o.push(i)}imageString=" = img`\n";for(let e=0;e<o.length;e++){var d=o[e];for(let t=0;t<d.length;t++){let e=d[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`",e.putImageData(n,0,0)}function floydSteinbergDithering(e,t,r){var n=e.getImageData(0,0,t,r),l=n.data,o=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var a=0;a<r;a++){for(var i=[],s=0;s<t;s++){var g=4*(a*t+s);oldpixel=[l[g],l[g+1],l[g+2]],newpixel=findClosest(oldpixel,palArr),i.push(palArr.indexOf(newpixel)+1),l[g]=newpixel[0],l[g+1]=newpixel[1],l[g+2]=newpixel[2],l[g+3]=255,quantErr=getQuantErr(oldpixel,newpixel),(g=4*(a*t+(s+1)))<l.length&&(err=applyErrBitShift([l[g],l[g+1],l[g+2]],quantErr,7,4),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+(s-1)))<l.length&&(err=applyErrBitShift([l[g],l[g+1],l[g+2]],quantErr,3,4),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+s))<l.length&&(err=applyErrBitShift([l[g],l[g+1],l[g+2]],quantErr,5,4),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+(s+1)))<l.length&&(err=applyErrBitShift([l[g],l[g+1],l[g+2]],quantErr,1,4),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2])}o.push(i)}imageString=" = img`\n";for(let e=0;e<o.length;e++){var d=o[e];for(let t=0;t<d.length;t++){let e=d[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`",e.putImageData(n,0,0)}function FalseFloydSteinbergDithering(e,t,r){var n=e.getImageData(0,0,t,r),l=n.data,o=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var a=0;a<r;a++){for(var i=[],s=0;s<t;s++){var g=4*(a*t+s);oldpixel=[l[g],l[g+1],l[g+2]],newpixel=findClosest(oldpixel,palArr),i.push(palArr.indexOf(newpixel)+1),l[g]=newpixel[0],l[g+1]=newpixel[1],l[g+2]=newpixel[2],l[g+3]=255,quantErr=getQuantErr(oldpixel,newpixel),(g=4*(a*t+(s+1)))<l.length&&(err=applyErrBitShift([l[g],l[g+1],l[g+2]],quantErr,3,3),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+(s+1)))<l.length&&(err=applyErrBitShift([l[g],l[g+1],l[g+2]],quantErr,2,3),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+s))<l.length&&(err=applyErrBitShift([l[g],l[g+1],l[g+2]],quantErr,3,3),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2])}o.push(i)}imageString=" = img`\n";for(let e=0;e<o.length;e++){var d=o[e];for(let t=0;t<d.length;t++){let e=d[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`",e.putImageData(n,0,0)}function stuckiDithering(e,t,r){var n=e.getImageData(0,0,t,r),l=n.data,o=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var a=0;a<r;a++){for(var i=[],s=0;s<t;s++){var g=4*(a*t+s);oldpixel=[l[g],l[g+1],l[g+2]],newpixel=findClosest(oldpixel,palArr),i.push(palArr.indexOf(newpixel)+1),l[g]=newpixel[0],l[g+1]=newpixel[1],l[g+2]=newpixel[2],l[g+3]=255,quantErr=getQuantErr(oldpixel,newpixel),(g=4*(a*t+(s+1)))<l.length&&(err=applyErrDiv([l[g],l[g+1],l[g+2]],quantErr,8,42),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*(a*t+(s+2)))<l.length&&(err=applyErrDiv([l[g],l[g+1],l[g+2]],quantErr,4,42),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+(s-2)))<l.length&&(err=applyErrDiv([l[g],l[g+1],l[g+2]],quantErr,2,42),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+(s-1)))<l.length&&(err=applyErrDiv([l[g],l[g+1],l[g+2]],quantErr,4,42),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+s))<l.length&&(err=applyErrDiv([l[g],l[g+1],l[g+2]],quantErr,8,42),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+(s+1)))<l.length&&(err=applyErrDiv([l[g],l[g+1],l[g+2]],quantErr,4,42),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+(s+2)))<l.length&&(err=applyErrDiv([l[g],l[g+1],l[g+2]],quantErr,2,42),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+2)*t+(s-2)))<l.length&&(err=applyErrDiv([l[g],l[g+1],l[g+2]],quantErr,1,42),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+2)*t+(s-1)))<l.length&&(err=applyErrDiv([l[g],l[g+1],l[g+2]],quantErr,2,42),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+2)*t+s))<l.length&&(err=applyErrDiv([l[g],l[g+1],l[g+2]],quantErr,4,42),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+2)*t+(s+1)))<l.length&&(err=applyErrDiv([l[g],l[g+1],l[g+2]],quantErr,2,42),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+2)*t+(s+2)))<l.length&&(err=applyErrDiv([l[g],l[g+1],l[g+2]],quantErr,1,42),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2])}o.push(i)}imageString=" = img`\n";for(let e=0;e<o.length;e++){var d=o[e];for(let t=0;t<d.length;t++){let e=d[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`",e.putImageData(n,0,0)}function BurkesDithering(e,t,r){var n=e.getImageData(0,0,t,r),l=n.data,o=[];palArr=removedisabledColors(hexToRgb(colors),enabledColorsList);for(var a=0;a<r;a++){for(var i=[],s=0;s<t;s++){var g=4*(a*t+s);oldpixel=[l[g],l[g+1],l[g+2]],newpixel=findClosest(oldpixel,palArr),i.push(palArr.indexOf(newpixel)+1),l[g]=newpixel[0],l[g+1]=newpixel[1],l[g+2]=newpixel[2],l[g+3]=255,quantErr=getQuantErr(oldpixel,newpixel),(g=4*(a*t+(s+1)))<l.length&&(err=applyErrBitShift([l[g],l[g+1],l[g+2]],quantErr,8,5),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*(a*t+(s+2)))<l.length&&(err=applyErrBitShift([l[g],l[g+1],l[g+2]],quantErr,4,5),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+(s-2)))<l.length&&(err=applyErrBitShift([l[g],l[g+1],l[g+2]],quantErr,2,5),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+(s-1)))<l.length&&(err=applyErrBitShift([l[g],l[g+1],l[g+2]],quantErr,4,5),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+s))<l.length&&(err=applyErrBitShift([l[g],l[g+1],l[g+2]],quantErr,8,5),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+(s+1)))<l.length&&(err=applyErrBitShift([l[g],l[g+1],l[g+2]],quantErr,4,5),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2]),(g=4*((a+1)*t+(s+2)))<l.length&&(err=applyErrBitShift([l[g],l[g+1],l[g+2]],quantErr,2,5),l[g]=err[0],l[g+1]=err[1],l[g+2]=err[2])}o.push(i)}imageString=" = img`\n";for(let e=0;e<o.length;e++){var d=o[e];for(let t=0;t<d.length;t++){let e=d[t];imageString+=e.toString(16)+" "}imageString+="\n"}imageString+="`",e.putImageData(n,0,0)}function InvertFilter(e,t,r){r=e.getImageData(0,0,t,r);const n=r.data;for(let e=0;e<n.length;e+=4){var l=n[e],o=n[e+1],a=n[e+2];n[e]=255-l,n[e+1]=255-o,n[e+2]=255-a}e.putImageData(r,0,0)}function noiseFilter(e,t,r,n){r=e.getImageData(0,0,t,r);const l=r.data;for(let e=0;e<l.length;e+=4){var o=l[e],a=l[e+1],i=l[e+2],s=[o+Math.random()*n,a+Math.random()*n,i+Math.random()*n];l[e]=Math.floor((o+s[0])/2),l[e+1]=Math.floor((a+s[1])/2),l[e+2]=Math.floor((i+s[2])/2)}e.putImageData(r,0,0)}function customFilter(e,t,r,n,l,o){r=e.getImageData(0,0,t,r);const a=r.data;for(let e=0;e<a.length;e+=4){var i=a[e],s=a[e+1],g=a[e+2],d=n/255,u=l/255,c=o/255;a[e]=d*i,a[e+1]=u*s,a[e+2]=c*g}e.putImageData(r,0,0)}function grayScale(e,t,r){r=e.getImageData(0,0,t,r);const n=r.data;for(let e=0;e<n.length;e+=4){var l=(n[e]+n[e+1]+n[e+2])/3;n[e]=l,n[e+1]=l,n[e+2]=l}e.putImageData(r,0,0)}function blurImage(e,s,g,t){var r=e.getImageData(0,0,s,g);const d=r.data;var u=Math.floor(t/2),t=2*u+1,c=1/Math.pow(t,2);const m=new Uint8ClampedArray(d.length);for(let i=0;i<g;i++)for(let a=0;a<s;a++){let r=0,n=0,l=0,o=0;for(let t=-u;t<=u;t++)for(let e=-u;e<=u;e++){var p=i+t,h=a+e;0<=p&&p<g&&0<=h&&h<s&&(h=4*(p*s+h),r+=d[h]*c,n+=d[1+h]*c,l+=d[2+h]*c,o+=d[3+h]*c)}var f=4*(i*s+a);m[f]=r,m[1+f]=n,m[2+f]=l,m[3+f]=o}for(let e=0;e<m.length;e++)d[e]=m[e];e.putImageData(r,0,0)}function unblurImage(e,l,o){var a=[[0,-1,0],[-1,5,-1],[0,-1,0]],t=e.getImageData(0,0,l,o);const i=t.data,s=new Uint8ClampedArray(i.length);for(let n=0;n<o;n++)for(let r=0;r<l;r++){var g=4*(n*l+r);const p=[0,0,0];for(let t=-1;t<=1;t++)for(let e=-1;e<=1;e++){var d,u=a[t+1][e+1],c=r+e,m=n+t;0<=c&&c<l&&0<=m&&m<o&&(d=4*(m*l+c),m=i[d],c=i[1+d],d=i[2+d],p[0]+=m*u,p[1]+=c*u,p[2]+=d*u)}s[g]=p[0],s[1+g]=p[1],s[2+g]=p[2],s[3+g]=i[3+g]}for(let e=0;e<i.length;e++)i[e]=s[e];e.putImageData(t,0,0)}function findClosest(t,r){let n=r[0],l=Math.abs(t[0]-n[0])+Math.abs(t[1]-n[1])+Math.abs(t[2]-n[2]);for(let e=1;e<r.length;e++){var[o,a,i]=r[e];(i=Math.abs(t[0]-o)+Math.abs(t[1]-a)+Math.abs(t[2]-i))<l&&(l=i,n=r[e])}return n}function getQuantErr(e,t){return e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e}function applyErrBitShift(e,t,r,n){return r*=multiplier,e[0]+=t[0]*r>>n,e[1]+=t[1]*r>>n,e[2]+=t[2]*r>>n,e}function applyErrDiv(e,t,r,n){return r*=multiplier,n=1/n,e[0]+=t[0]*r*n,e[1]+=t[1]*r*n,e[2]+=t[2]*r*n,e}function addColor(){const e=document.getElementById("colorInput");var t=e.value.trim();t&&(colors.push(t),enabledColorsList.push(!0),renderColors())}function changeColor(e){const t=document.getElementById("colorInput");var r=t.value.trim();colors[e]=r,renderColors()}function removeColor(e){colors.splice(e,1),enabledColorsList.splice(e,1),renderColors()}function moveUp(e){var t;0<e&&(t=[colors[e],colors[e-1]],colors[e]=t[1],colors[e-1]=t[0],t=[enabledColorsList[e],enabledColorsList[e-1]],enabledColorsList[e]=t[1],enabledColorsList[e-1]=t[0],renderColors())}function moveDown(e){var t;e<colors.length-1&&(t=[colors[e],colors[e+1]],colors[e]=t[1],colors[e+1]=t[0],t=[enabledColorsList[e],enabledColorsList[e+1]],enabledColorsList[e]=t[1],enabledColorsList[e+1]=t[0],renderColors())}function renderColors(){const c=document.getElementById("colorList");c.innerHTML="",colors.forEach((e,t)=>{const r=document.createElement("li"),n=t+1,l=document.createElement("span");l.textContent=e.toUpperCase()+", "+n.toString(16).toUpperCase(),l.style.color="#ffffff",r.appendChild(l);const o=document.createElement("canvas");o.width=50,o.height=20;const a=o.getContext("2d");a.fillStyle=e,a.fillRect(0,0,o.width,o.height),r.appendChild(o);const i=document.createElement("button");i.textContent="Remove",i.addEventListener("click",()=>removeColor(t)),r.appendChild(i);const s=document.createElement("button");s.textContent="Change",s.addEventListener("click",()=>changeColor(t)),r.appendChild(s);const g=document.createElement("button");g.textContent="↑",g.addEventListener("click",()=>moveUp(t)),r.appendChild(g);const d=document.createElement("button");d.textContent="↓",d.addEventListener("click",()=>moveDown(t)),r.appendChild(d);const u=document.createElement("button");u.textContent=enabledColorsList[t]?"Disable":"Enable",u.classList.add(enabledColorsList[t]?"enabled":"disabled"),u.addEventListener("click",()=>enableColor(t)),r.appendChild(u),c.appendChild(r)})}function enableColor(e){enabledColorsList[e]=!enabledColorsList[e],renderColors()}function hexToRgb(e){return e.map(e=>{return[parseInt(e.substring(1,3),16),parseInt(e.substring(3,5),16),parseInt(e.substring(5,7),16)]})}function rgbToHex(e){return e.map(e=>"#"+e.map(e=>{e=e.toString(16);return 1===e.length?"0"+e:e}).join(""))}function arrayEquals(e,t){return JSON.stringify(e)===JSON.stringify(t)}function addFilter(){let e;var t=document.getElementById("Filters").value;"none"!=t&&(filterList.push(t),e="custom"==t?[document.getElementById("red").value,document.getElementById("green").value,document.getElementById("blue").value]:"noise"==t?[document.getElementById("noiseLevel").value]:"blur"==t?[Math.min(Math.abs(document.getElementById("blurPower").value),50)]:"median"==t?[Math.min(Math.abs(document.getElementById("blurPower").value),10)]:[],filterEffectPowerList.push(e))}function resetFilter(){filterList=[],filterEffectPowerList=[]}window.onload=function(){for(var e=document.getElementById("colorLists"),t=0;t<localStorage.length;t++){var r=localStorage.key(t),n=document.createElement("option");n.text=r,n.value=r,e.add(n)}},document.getElementById("red").addEventListener("input",function(){changeColorPickerColor()}),document.getElementById("green").addEventListener("input",function(){changeColorPickerColor()}),document.getElementById("blue").addEventListener("input",function(){changeColorPickerColor()}),document.getElementById("Filters").addEventListener("change",function(){var e=this.value,t=document.getElementById("customFilter"),r=document.getElementById("NoiseFilter"),n=document.getElementById("blurFilter"),l=document.getElementById("RadiusFilter");t.style.display="none",r.style.display="none",n.style.display="none",l.style.display="none","custom"===e?t.style.display="block":"noise"===e?r.style.display="block":"blur"===e?n.style.display="block":"median"===e&&(l.style.display="block"),fliterOption=e}),document.getElementById("sizeSettings").addEventListener("change",function(){var e=this.value;document.getElementById("scaleOptions").style.display="none",document.getElementById("pixelGoalOptions").style.display="none",document.getElementById("widthHeightOptions").style.display="none",document.getElementById(e+"Options").style.display="block"}),document.getElementById("version").addEventListener("input",easterEgg),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("ditheringOptions"),r=document.getElementById("hoverBox"),n=document.getElementById("hoverDescription");e.addEventListener("mouseover",function(e){var t;"OPTION"===e.target.tagName&&(t=e.target.getAttribute("data-description"),e=e.target.getBoundingClientRect(),n.textContent=t,r.style.display="block",r.style.left=e.left+"px",r.style.top=e.top+window.scrollY+20+"px")}),e.addEventListener("mouseout",function(){r.style.display="none"})});
